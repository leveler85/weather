<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>HWANG's WEATHER</title>
<link rel="icon" type="image/png" href="data:image/png;base64,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">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=DM+Serif+Display:ital@0;1&family=DM+Mono:wght@300;400;500&family=Noto+Sans+KR:wght@300;400;500&display=swap" rel="stylesheet">
<style>
html,body{overflow-x:hidden;width:100%}
*,*::before,*::after{box-sizing:border-box}
:root{
  --bg:#080c14;--surface:#0e1420;--surface2:#141c2e;
  --border:rgba(255,255,255,0.06);--accent:#4f9cf9;--accent2:#7dd3fc;
  --text:#e8edf5;--muted:#5a6478;--warm:#f59e0b;--cold:#818cf8;
  --good:#34d399;--warn:#fbbf24;--bad:#f97316;--danger:#f87171;
}
*{margin:0;padding:0;box-sizing:border-box}
html{scroll-behavior:smooth}
body{
  background:var(--bg);color:var(--text);
  font-family:'DM Mono','Noto Sans KR',monospace;
  min-height:100vh;overflow-x:hidden;transition:background 1.5s ease;
}

/* â”€â”€ ë‚ ì”¨ ë°°ê²½ í…Œë§ˆ â”€â”€ */
body.wx-clear   {background:linear-gradient(160deg,#040d1a 0%,#0a1628 40%,#061220 100%)}
body.wx-cloudy  {background:linear-gradient(160deg,#0d1117 0%,#141b2a 50%,#0e1520 100%)}
body.wx-rain    {background:linear-gradient(160deg,#050c14 0%,#0a1220 50%,#060d18 100%)}
body.wx-snow    {background:linear-gradient(160deg,#0b0f1a 0%,#131a2e 50%,#0d1525 100%)}
body.wx-fog     {background:linear-gradient(160deg,#0d1118 0%,#161c24 50%,#10151e 100%)}
body.wx-thunder {background:linear-gradient(160deg,#08060f 0%,#100c1a 50%,#080610 100%)}

.bg-orb{
  position:fixed;border-radius:50%;pointer-events:none;z-index:0;
  transition:all 1.5s ease;
}
.bg-orb-1{top:-150px;left:-150px;width:500px;height:500px;
  background:radial-gradient(circle,rgba(79,156,249,0.08) 0%,transparent 70%);
  animation:breathe 9s ease-in-out infinite alternate;
}
.bg-orb-2{bottom:-100px;right:-100px;width:400px;height:400px;
  background:radial-gradient(circle,rgba(129,140,248,0.05) 0%,transparent 70%);
  animation:breathe 12s ease-in-out infinite alternate-reverse;
}
body.wx-rain    .bg-orb-1{background:radial-gradient(circle,rgba(96,165,250,0.1) 0%,transparent 70%)}
body.wx-snow    .bg-orb-1{background:radial-gradient(circle,rgba(186,230,253,0.08) 0%,transparent 70%)}
body.wx-thunder .bg-orb-1{background:radial-gradient(circle,rgba(167,139,250,0.12) 0%,transparent 70%)}
body.wx-clear   .bg-orb-1{background:radial-gradient(circle,rgba(251,191,36,0.06) 0%,transparent 70%)}

/* Rain animation */
.rain-container{
  position:fixed;top:0;left:0;right:0;bottom:0;
  pointer-events:none;z-index:0;overflow:hidden;display:none;
}
body.wx-rain .rain-container{display:block}
.raindrop{
  position:absolute;top:-20px;width:1px;
  background:linear-gradient(180deg,transparent,rgba(147,197,253,0.4));
  animation:fall linear infinite;
}
@keyframes fall{to{transform:translateY(110vh)}}

/* Snow animation */
.snow-container{
  position:fixed;top:0;left:0;right:0;bottom:0;
  pointer-events:none;z-index:0;overflow:hidden;display:none;
}
body.wx-snow .snow-container{display:block}
.snowflake{
  position:absolute;top:-10px;color:rgba(186,230,253,0.5);font-size:10px;
  animation:snowfall linear infinite;
}
@keyframes snowfall{to{transform:translateY(110vh) rotate(360deg)}}
@keyframes breathe{from{transform:scale(1)}to{transform:scale(1.3)}}
@keyframes fadeUp{from{opacity:0;transform:translateY(16px)}to{opacity:1;transform:none}}
@keyframes spin{from{transform:rotate(0deg)}to{transform:rotate(360deg)}}
@keyframes slideIn{from{opacity:0;transform:translateX(-12px)}to{opacity:1;transform:none}}
@keyframes pulse{0%,100%{opacity:1}50%{opacity:.5}}

.app{position:relative;z-index:1;max-width:1200px;margin:0 auto;padding:32px 24px;box-sizing:border-box}
/* macOS Electron - íƒ€ì´í‹€ë°” ê³µê°„ */
.electron-app .app{padding-top:52px}
.titlebar-drag{
  position:fixed;top:0;left:0;right:0;height:44px;
  -webkit-app-region:drag;z-index:9999;
  background:linear-gradient(180deg,rgba(8,12,20,.9) 0%,transparent 100%);
  pointer-events:none;
}

/* â”€â”€ HEADER â”€â”€ */
header{display:flex;align-items:center;gap:12px;flex-wrap:wrap;margin-bottom:32px}
.logo{font-family:'DM Serif Display',serif;font-size:1.5rem;letter-spacing:.03em;flex-shrink:0;white-space:nowrap}
.logo span{color:var(--accent)}
.header-right{display:flex;align-items:center;gap:8px;margin-left:auto;flex-wrap:wrap}

/* Lang switcher */
.lang-btn{
  background:var(--surface);border:1px solid var(--border);
  border-radius:8px;padding:7px 12px;color:var(--muted);
  cursor:pointer;font-size:.75rem;font-family:'DM Mono',monospace;
  transition:all .2s;letter-spacing:.05em;
}
.lang-btn:hover,.lang-btn.active{border-color:var(--accent);color:var(--accent)}

/* Compare toggle */
.compare-btn{
  background:var(--surface);border:1px solid var(--border);
  border-radius:8px;padding:7px 12px;color:var(--muted);
  cursor:pointer;font-size:.75rem;font-family:'DM Mono',monospace;
  transition:all .2s;display:flex;align-items:center;gap:5px;
}
.compare-btn:hover{border-color:var(--accent2);color:var(--accent2)}
.compare-btn.active{border-color:var(--accent2);color:var(--accent2);background:rgba(125,211,252,.05)}

.search-wrap{position:relative;flex:1;min-width:180px;max-width:400px}
.search-wrap input{
  width:100%;background:var(--surface);border:1px solid var(--border);
  border-radius:12px;padding:11px 44px 11px 16px;color:var(--text);
  font-family:'DM Mono',monospace;font-size:.82rem;outline:none;
  transition:border-color .2s,box-shadow .2s;
}
.search-wrap input:focus{border-color:rgba(79,156,249,.4);box-shadow:0 0 0 3px rgba(79,156,249,.08)}
.search-wrap input::placeholder{color:var(--muted)}
.search-btn{
  position:absolute;right:10px;top:50%;transform:translateY(-50%);
  background:none;border:none;cursor:pointer;color:var(--muted);
  font-size:1rem;transition:color .2s;padding:4px;
}
.search-btn:hover{color:var(--accent)}
.autocomplete{
  position:absolute;top:calc(100% + 6px);left:0;right:0;
  background:var(--surface2);border:1px solid rgba(79,156,249,.25);
  border-radius:10px;overflow:hidden;z-index:200;display:none;
  max-height:260px;overflow-y:auto;box-shadow:0 8px 32px rgba(0,0,0,.6);
}
.autocomplete.show{display:block}
.auto-item{
  padding:10px 14px;font-size:.8rem;cursor:pointer;
  display:flex;align-items:center;gap:8px;transition:background .15s;
  border-bottom:1px solid var(--border);
}
.auto-item:last-child{border-bottom:none}
.auto-item:hover,.auto-item.selected{background:rgba(79,156,249,.1)}
.auto-city{flex:1;color:var(--text)}
.auto-eng{font-size:.7rem;color:var(--muted)}
.loc-btn{
  background:var(--surface);border:1px solid var(--border);
  border-radius:10px;padding:9px 13px;color:var(--muted);
  cursor:pointer;font-size:.78rem;display:flex;align-items:center;
  gap:5px;transition:all .2s;white-space:nowrap;flex-shrink:0;
}
.loc-btn:hover{border-color:var(--accent);color:var(--accent)}

/* â”€â”€ COMPARE MODE â”€â”€ */
.compare-panel{
  display:none;background:var(--surface);border:1px solid var(--border);
  border-radius:16px;padding:20px 24px;margin-bottom:20px;animation:fadeUp .4s ease;
}
.compare-panel.show{display:block}
.compare-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:16px}
.compare-title{font-size:.68rem;letter-spacing:.12em;text-transform:uppercase;color:var(--muted)}
.compare-searches{display:grid;grid-template-columns:1fr 1fr;gap:12px}
.compare-search{position:relative}
.compare-search input{
  width:100%;background:var(--surface2);border:1px solid var(--border);
  border-radius:10px;padding:10px 14px;color:var(--text);
  font-family:'DM Mono',monospace;font-size:.82rem;outline:none;
  transition:border-color .2s;
}
.compare-search input:focus{border-color:rgba(79,156,249,.4)}
.compare-search input::placeholder{color:var(--muted)}
.compare-ac{
  position:absolute;top:calc(100% + 4px);left:0;right:0;
  background:var(--surface);border:1px solid rgba(79,156,249,.25);
  border-radius:8px;z-index:200;display:none;max-height:200px;overflow-y:auto;
}
.compare-ac.show{display:block}
.compare-result{
  display:none;grid-template-columns:1fr auto 1fr;
  gap:20px;align-items:start;margin-top:20px;
}
.compare-result.show{display:grid}
.cmp-card{background:var(--surface2);border-radius:14px;padding:20px;border:1px solid var(--border);animation:fadeUp .4s ease}
.cmp-city{font-family:'DM Serif Display',serif;font-size:1.3rem;margin-bottom:4px}
.cmp-temp{font-family:'DM Serif Display',serif;font-size:3rem;line-height:1;margin:12px 0 8px}
.cmp-desc{font-size:.82rem;color:var(--accent2);margin-bottom:12px}
.cmp-row{display:flex;justify-content:space-between;font-size:.75rem;color:var(--muted);padding:5px 0;border-bottom:1px solid var(--border)}
.cmp-row:last-child{border-bottom:none}
.cmp-row span:last-child{color:var(--text)}
.vs-badge{
  display:flex;align-items:center;justify-content:center;
  font-family:'DM Serif Display',serif;font-size:1.4rem;
  color:var(--muted);padding-top:60px;
}

/* â”€â”€ STATUS â”€â”€ */
.state-msg{text-align:center;padding:60px 20px;color:var(--muted);font-size:.88rem;line-height:2.5}
.state-msg .icon{font-size:3rem;display:block;margin-bottom:12px}
.spinner{display:inline-block;width:36px;height:36px;border:3px solid var(--border);border-top-color:var(--accent);border-radius:50%;animation:spin .8s linear infinite;margin-bottom:14px}
.err-box{background:rgba(248,113,113,.07);border:1px solid rgba(248,113,113,.2);border-radius:12px;padding:18px 22px;margin:20px 0;font-size:.8rem;color:#f87171;line-height:1.9}
.tip-box{background:rgba(79,156,249,.06);border:1px solid rgba(79,156,249,.15);border-radius:12px;padding:14px 18px;margin-top:14px;font-size:.78rem;color:var(--muted);line-height:1.9}
.tip-box strong{color:var(--accent2)}

/* â”€â”€ MAIN CARD â”€â”€ */
.main-card{
  border:1px solid var(--border);border-radius:20px;
  padding:32px 36px;margin-bottom:20px;position:relative;
  overflow:hidden;animation:fadeUp .5s ease;
  transition:background 1.5s ease;
  background:var(--surface);
}
body.wx-clear   .main-card{background:linear-gradient(135deg,rgba(14,20,32,1) 0%,rgba(12,24,48,0.9) 100%)}
body.wx-rain    .main-card{background:linear-gradient(135deg,rgba(10,18,32,1) 0%,rgba(8,16,32,0.95) 100%)}
body.wx-snow    .main-card{background:linear-gradient(135deg,rgba(14,20,40,1) 0%,rgba(16,22,44,0.95) 100%)}
body.wx-thunder .main-card{background:linear-gradient(135deg,rgba(12,8,20,1) 0%,rgba(16,10,28,0.95) 100%)}

.main-card::before{
  content:'';position:absolute;top:0;left:0;right:0;height:2px;
  background:linear-gradient(90deg,transparent,var(--accent),transparent);
  opacity:.5;transition:background 1.5s;
}
body.wx-snow    .main-card::before{background:linear-gradient(90deg,transparent,#bae6fd,transparent)}
body.wx-thunder .main-card::before{background:linear-gradient(90deg,transparent,#a78bfa,transparent)}
body.wx-clear   .main-card::before{background:linear-gradient(90deg,transparent,#fbbf24,transparent)}

.city-name{font-family:'DM Serif Display',serif;font-size:2.2rem;font-weight:400;margin-bottom:4px}
.city-meta{color:var(--muted);font-size:.72rem;letter-spacing:.07em;text-transform:uppercase;margin-bottom:28px}
.main-content{display:flex;align-items:flex-end;gap:36px;flex-wrap:wrap}
.temp-display{display:flex;align-items:flex-start;gap:4px}
.temp-big{font-family:'DM Serif Display',serif;font-size:7rem;line-height:1;cursor:pointer;user-select:none;transition:color .3s}
.temp-big:hover{color:var(--accent)}
.temp-unit{font-size:1.8rem;color:var(--muted);margin-top:10px}
.weather-detail{flex:1;min-width:200px}
.weather-desc{font-size:1.05rem;color:var(--accent2);margin-bottom:14px;font-family:'DM Serif Display',serif;font-style:italic}
.detail-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:9px}
.detail-item{display:flex;flex-direction:column;gap:2px}
.detail-label{color:var(--muted);font-size:.66rem;letter-spacing:.1em;text-transform:uppercase}
.detail-val{font-size:.85rem}

/* â”€â”€ OUTFIT CARD â”€â”€ */
.outfit-card{
  background:var(--surface);border:1px solid var(--border);
  border-radius:16px;padding:22px 26px;margin-bottom:20px;
  animation:fadeUp .5s ease;display:flex;gap:20px;align-items:flex-start;
  flex-wrap:wrap;
}
.outfit-icon-wrap{display:none}
.outfit-content{flex:1;min-width:200px}
.outfit-label{font-size:.8rem;letter-spacing:.14em;text-transform:uppercase;color:#f97316;font-weight:700;margin-bottom:8px;text-shadow:0 0 12px rgba(249,115,22,.4)}
.outfit-title{font-family:'DM Serif Display',serif;font-size:1.3rem;color:var(--text);margin-bottom:8px}
.outfit-desc{font-size:.8rem;color:var(--muted);line-height:1.7}
.outfit-tags{display:flex;flex-wrap:wrap;gap:6px;margin-top:10px}
.outfit-tag{
  background:var(--surface2);border:1px solid var(--border);
  border-radius:6px;padding:4px 10px;font-size:.72rem;color:var(--text);
}

/* â”€â”€ LAYOUT â”€â”€ */
.grid-row{display:grid;gap:20px;margin-bottom:20px}
.grid-2{grid-template-columns:1fr 1fr}
.grid-3{grid-template-columns:repeat(3,1fr)}
.card{
  background:var(--surface);border:1px solid var(--border);
  border-radius:16px;padding:22px;animation:fadeUp .5s ease;
}
.card-title{font-size:.66rem;letter-spacing:.12em;text-transform:uppercase;color:var(--muted);margin-bottom:14px}

/* â”€â”€ HOURLY â”€â”€ */
.hourly-scroll{display:flex;gap:10px;overflow-x:auto;padding-bottom:8px;scrollbar-width:thin;scrollbar-color:var(--border) transparent}
.hour-item{
  flex-shrink:0;display:flex;flex-direction:column;align-items:center;gap:5px;
  background:var(--surface2);border-radius:12px;padding:10px 12px;
  min-width:60px;border:1px solid var(--border);
  transition:border-color .2s,transform .2s;cursor:default;
}
.hour-item:hover{border-color:var(--accent);transform:translateY(-2px)}
.hour-item.now{border-color:var(--accent);background:rgba(79,156,249,.08)}
.hour-time{font-size:.68rem;color:var(--muted)}
.hour-icon{font-size:1.3rem}
.hour-temp{font-size:.82rem}
.hour-precip{font-size:.62rem;color:var(--accent)}

/* â”€â”€ PRECIP CHART â”€â”€ */
.chart-wrap{position:relative;height:120px;margin-top:8px}
.chart-canvas{width:100%;height:100%}
.chart-legend{display:flex;gap:16px;margin-top:8px;flex-wrap:wrap}
.chart-legend-item{display:flex;align-items:center;gap:5px;font-size:.7rem;color:var(--muted)}
.legend-dot{width:8px;height:8px;border-radius:50%}

/* â”€â”€ DAILY â”€â”€ */
.day-list{display:flex;flex-direction:column;gap:5px}
.day-item{
  display:grid;grid-template-columns:110px 1fr 50px 50px;
  align-items:center;gap:10px;padding:9px 12px;
  border-radius:10px;transition:background .15s;
}
.day-item:hover{background:var(--surface2)}
.day-name{font-size:.8rem}
.day-bar-wrap{position:relative;height:4px;background:var(--surface2);border-radius:2px}
.day-bar{position:absolute;height:100%;border-radius:2px;background:linear-gradient(90deg,var(--cold),var(--accent),var(--warm))}
.day-lo{font-size:.76rem;color:var(--muted);text-align:right}
.day-hi{font-size:.8rem;text-align:right}

/* â”€â”€ AQI â”€â”€ */
.aqi-display{display:flex;flex-direction:column;gap:0}
.aqi-hero{
  display:flex;align-items:stretch;gap:0;
}
.aqi-score-block{
  display:flex;flex-direction:column;align-items:center;justify-content:center;
  padding:22px 24px;flex-shrink:0;min-width:120px;position:relative;overflow:hidden;
}
.aqi-score-block::before{
  content:'';position:absolute;inset:0;
  background:radial-gradient(circle at 50% 60%,var(--aqi-glow,rgba(52,211,153,.25)) 0%,transparent 70%);
}
.aqi-num{font-family:'DM Serif Display',serif;font-size:3.6rem;line-height:1;font-weight:900;position:relative;z-index:1}
.aqi-lbl{font-size:.58rem;letter-spacing:.18em;text-transform:uppercase;color:rgba(255,255,255,.65);margin-top:3px;position:relative;z-index:1}
.aqi-grade-badge{
  margin-top:8px;padding:3px 12px;border-radius:20px;font-size:.72rem;font-weight:700;
  letter-spacing:.05em;position:relative;z-index:1;color:#fff;
}
.aqi-right{flex:1;display:flex;flex-direction:column;justify-content:center;padding:18px 20px;border-left:1px solid var(--border)}
.aqi-right-desc{font-size:.82rem;line-height:1.75;color:var(--muted);margin-bottom:14px}
.aqi-bar-wrap{display:flex;flex-direction:column;gap:5px}
.aqi-bar-label{display:flex;justify-content:space-between;align-items:center;font-size:.62rem;color:var(--muted);letter-spacing:.06em}
.aqi-bar-track{height:6px;border-radius:3px;background:var(--border);overflow:hidden}
.aqi-bar-fill{height:100%;border-radius:3px;transition:width .6s cubic-bezier(.4,0,.2,1)}
.aqi-level-strip{
  display:grid;grid-template-columns:repeat(4,1fr);gap:0;border-top:1px solid var(--border);
}
.aqi-level-cell{
  padding:10px 8px;text-align:center;position:relative;
}
.aqi-level-cell.active::after{
  content:'â–²';position:absolute;top:-10px;left:50%;transform:translateX(-50%);
  font-size:.6rem;color:inherit;
}
.aqi-level-dot{width:8px;height:8px;border-radius:50%;margin:0 auto 5px}
.aqi-level-name{font-size:.65rem;font-weight:700;letter-spacing:.05em}
.aqi-level-range{font-size:.56rem;color:var(--muted);margin-top:2px}
.pm-row{display:grid;grid-template-columns:repeat(3,1fr);gap:0;border-top:1px solid var(--border)}
.pm-item{padding:14px 10px;text-align:center;border-right:1px solid var(--border);background:var(--surface2)}
.pm-item:last-child{border-right:none}
.pm-name{font-size:.62rem;color:var(--muted);text-transform:uppercase;letter-spacing:.1em;margin-bottom:5px}
.pm-val{font-size:1.2rem;font-family:'DM Serif Display',serif;font-weight:700}
.pm-unit{font-size:.56rem;color:var(--muted);margin-top:3px}
.pm-bar-track{height:4px;border-radius:2px;background:var(--border);overflow:hidden;margin-top:6px}
.pm-bar-fill{height:100%;border-radius:2px}

/* â”€â”€ AQI ê±´ê°• ê°€ì´ë“œ â”€â”€ */
.aqi-health-wrap{display:flex;flex-direction:column;gap:0}
.aqi-action-row{
  display:grid;grid-template-columns:repeat(3,1fr);gap:0;
  border-bottom:1px solid var(--border);
}
.aqi-action-item{
  display:flex;flex-direction:column;align-items:center;justify-content:center;
  padding:16px 10px;gap:8px;border-right:1px solid var(--border);
  text-align:center;
}
.aqi-action-item:last-child{border-right:none}
.aqi-action-icon{font-size:1.8rem;line-height:1;filter:drop-shadow(0 0 6px rgba(255,255,255,.15))}
.aqi-action-text{font-size:.7rem;color:var(--text);font-weight:600;letter-spacing:.02em;line-height:1.4}
.aqi-sensitive-row{padding:14px 18px}
.aqi-sensitive-title{font-size:.65rem;letter-spacing:.1em;text-transform:uppercase;color:var(--muted);margin-bottom:10px}
.aqi-sensitive-items{display:flex;flex-wrap:wrap;gap:8px}
.aqi-sensitive-item{
  display:flex;align-items:center;gap:5px;
  padding:5px 12px;border-radius:20px;font-size:.72rem;font-weight:600;
  border:1px solid var(--border);
  background:var(--surface2);color:var(--muted);
  transition:all .3s;
}
.aqi-sensitive-item.affected{
  border-color:var(--aqi-col, #f97316);
  color:var(--text);
  background:color-mix(in srgb, var(--aqi-col, #f97316) 12%, transparent);
  box-shadow:0 0 8px color-mix(in srgb, var(--aqi-col, #f97316) 20%, transparent);
}

/* â”€â”€ SUN / WIND / STATS â”€â”€ */
.sun-row{display:flex;gap:12px}
.sun-item{flex:1;background:var(--surface2);border-radius:12px;padding:12px 14px;text-align:center}
.sun-icon{font-size:1.5rem;margin-bottom:5px}
.sun-time{font-size:.87rem}
.sun-lbl{font-size:.62rem;color:var(--muted);text-transform:uppercase;letter-spacing:.1em;margin-top:2px}
.wind-compass{
  position:relative;width:76px;height:76px;margin:0 auto 14px;
  border:1px solid var(--border);border-radius:50%;
  display:flex;align-items:center;justify-content:center;
}
.wind-arrow{
  width:3px;height:26px;
  background:linear-gradient(180deg,var(--accent),transparent);
  border-radius:2px;transform-origin:bottom center;
}
.wind-stats{text-align:center}
.wind-speed{font-family:'DM Serif Display',serif;font-size:1.7rem}
.wind-unit{font-size:.68rem;color:var(--muted)}
.big-stat{
  display:flex;flex-direction:column;justify-content:center;
  align-items:center;text-align:center;height:100%;gap:7px;
}
.big-stat .val{font-family:'DM Serif Display',serif;font-size:2rem}
.big-stat .unit-lbl{font-size:.68rem;color:var(--muted);text-transform:uppercase;letter-spacing:.1em}

/* â”€â”€ RESPONSIVE â”€â”€ */
@media(max-width:900px){.compare-searches,.compare-result{grid-template-columns:1fr}}
@media(max-width:768px){
  .grid-2,.grid-3{grid-template-columns:1fr}
  .main-card{padding:18px}
  .temp-big{font-size:5rem}
  .city-name{font-size:1.6rem}
  .search-wrap{max-width:100%;flex:unset;width:100%}
  header{gap:8px;flex-wrap:wrap}
  .app{padding:16px 14px}
  .weather-detail{min-width:0;width:100%}
  .outfit-content{min-width:0;width:100%}
  .brief-content{min-width:0;width:100%}
  /* ë¸Œë¦¬í•‘: ì„¸ë¡œ ìŠ¤íƒ */
  .brief-card{flex-direction:column;gap:10px;padding:16px}
  .brief-icon{font-size:1.8rem;padding-top:0}
  .brief-text{font-size:.84rem;line-height:1.75;word-break:keep-all}
  /* ì˜·ì°¨ë¦¼ */
  .outfit-card{padding:16px}
  .outfit-visual{flex-direction:column;align-items:flex-start;gap:14px;padding:16px}
  .outfit-big-emoji{font-size:3.5rem}
  .outfit-items-row{flex-wrap:wrap}
  /* AQI */
  .aqi-hero{flex-direction:column}
  .aqi-score-block{width:100%;flex-direction:row;gap:20px;justify-content:flex-start;padding:16px 20px}
  .aqi-right{border-left:none;border-top:1px solid var(--border);padding:14px 16px}
  .aqi-level-strip{grid-template-columns:repeat(4,1fr)}
  .aqi-action-row{grid-template-columns:repeat(3,1fr)}
  /* ì‹œê°„ë³„ ì˜ˆë³´ */
  .hourly-scroll{gap:8px}
  /* í—¤ë” */
  .header-right{width:100%;justify-content:flex-end;flex-wrap:wrap}
}
@media(max-width:480px){
  .app{padding:12px 10px}
  .header-right{width:100%;justify-content:flex-end}
  .temp-big{font-size:4.2rem}
  .city-name{font-size:1.4rem}
  /* ë¸Œë¦¬í•‘ */
  .brief-card{padding:14px}
  .brief-label{font-size:.6rem}
  .brief-text{font-size:.82rem}
  /* ìµœê³ /ìµœì € span inline-flex â†’ wrap */
  .brief-text span[style*="inline-flex"]{flex-wrap:wrap;gap:10px}
  /* AQI ë ˆë²¨ ìŠ¤íŠ¸ë¦½ ê¸€ì */
  .aqi-level-name{font-size:.6rem}
  .aqi-level-range{font-size:.52rem}
  .aqi-action-text{font-size:.65rem}
  .aqi-sensitive-item{font-size:.66rem;padding:4px 8px}
  /* ì˜·ì°¨ë¦¼ */
  .outfit-pill{font-size:.68rem;padding:5px 9px}
  /* ì¹´ë“œ */
  .card{padding:16px}
  .card-title{font-size:.6rem}
  /* ì‹œê°„ë³„ */
  .hour-card{min-width:52px;padding:10px 6px}
  .hour-temp{font-size:.82rem}
  /* 7ì¼ */
  .day-item{font-size:.78rem}
}
/* â”€â”€ ì˜·ì°¨ë¦¼ ë¹„ì£¼ì–¼ (ì‹¬í”Œ) â”€â”€ */
.outfit-card{display:block}
.outfit-visual{
  display:flex;align-items:center;gap:20px;
  margin-top:18px;padding:20px 24px;
  background:linear-gradient(135deg,rgba(255,255,255,.03),rgba(255,255,255,.01));
  border:1px solid rgba(255,255,255,.06);border-radius:16px;
  position:relative;overflow:hidden;
}
.outfit-visual::before{
  content:'';position:absolute;inset:0;
  background:var(--outfit-bg,rgba(79,156,249,.04));
  pointer-events:none;
}
.outfit-big-emoji{
  font-size:5rem;line-height:1;flex-shrink:0;
  filter:drop-shadow(0 4px 16px rgba(0,0,0,.3));
  animation:outfitPop .5s cubic-bezier(.34,1.56,.64,1);
}
@keyframes outfitPop{
  from{transform:scale(.6);opacity:0}
  to{transform:scale(1);opacity:1}
}
.outfit-detail{flex:1;min-width:0}
.outfit-temp-badge{
  display:inline-flex;align-items:center;gap:6px;
  background:var(--outfit-accent,rgba(79,156,249,.15));
  border:1px solid var(--outfit-border,rgba(79,156,249,.3));
  border-radius:20px;padding:4px 12px;
  font-size:.72rem;color:var(--outfit-color,#7dd3fc);
  margin-bottom:10px;letter-spacing:.04em;
}
.outfit-items-row{
  display:flex;gap:8px;flex-wrap:wrap;margin-bottom:10px;
}
.outfit-pill{
  display:flex;align-items:center;gap:5px;
  background:rgba(255,255,255,.05);border:1px solid rgba(255,255,255,.08);
  border-radius:20px;padding:5px 11px;
  font-size:.78rem;color:var(--text);white-space:nowrap;
  transition:all .2s;
}
.outfit-pill:hover{
  background:rgba(255,255,255,.09);
  border-color:rgba(255,255,255,.15);
  transform:translateY(-1px);
}
.outfit-pill-emoji{font-size:.9rem;line-height:1}
.outfit-tip{
  font-size:.9rem;color:#facc15;font-weight:800;line-height:1.6;
  margin-top:8px;
  border-left:3px solid #facc15;
  padding-left:12px;
  letter-spacing:.03em;
  text-shadow:0 0 10px rgba(250,204,21,.5);
}

/* â”€â”€ ì¦ê²¨ì°¾ê¸° ë°” â”€â”€ */
.fav-bar{
  display:flex;gap:8px;flex-wrap:wrap;
  margin-bottom:16px;align-items:center;
  min-height:0;
}
.fav-chip{
  background:var(--surface);border:1px solid var(--border);
  border-radius:20px;padding:6px 10px 6px 12px;
  font-size:.75rem;cursor:pointer;
  display:flex;align-items:center;gap:6px;
  transition:all .2s;white-space:nowrap;color:var(--text);
}
.fav-chip:hover{border-color:var(--accent);color:var(--accent)}
.fav-chip .fav-temp{
  font-size:.7rem;color:var(--accent2);margin-left:2px;
}
.fav-chip .fav-x{
  color:var(--muted);font-size:.75rem;line-height:1;
  padding:1px 2px;border-radius:3px;transition:color .15s;
}
.fav-chip .fav-x:hover{color:var(--danger)}
.fav-add{
  background:transparent;border:1px dashed rgba(255,255,255,.12);
  border-radius:20px;padding:6px 12px;font-size:.75rem;
  color:var(--muted);cursor:pointer;transition:all .2s;
  font-family:'DM Mono',monospace;white-space:nowrap;
}
.fav-add:hover{border-color:var(--accent);color:var(--accent)}

/* â”€â”€ ì£¼ê°„ ê¸°ì˜¨ ê·¸ë˜í”„ â”€â”€ */
.week-chart-wrap{
  position:relative;height:140px;margin-top:8px;
}
.week-chart-canvas{width:100%;height:100%}

/* â”€â”€ ë‚ ì”¨ ë¸Œë¦¬í•‘ â”€â”€ */
.brief-card{
  background:linear-gradient(135deg,rgba(79,156,249,.08),rgba(125,211,252,.04));
  border:1px solid rgba(79,156,249,.18);border-radius:16px;
  padding:18px 24px;margin-bottom:20px;animation:fadeUp .5s ease;
  display:flex;align-items:flex-start;gap:16px;flex-wrap:wrap;
}
.brief-icon{font-size:2.2rem;flex-shrink:0;line-height:1;padding-top:2px}
.brief-content{flex:1;min-width:200px}
.brief-label{font-size:.62rem;letter-spacing:.12em;text-transform:uppercase;color:var(--accent);margin-bottom:6px}
.brief-text{font-size:.88rem;line-height:1.8;color:var(--text)}
.brief-alerts{display:flex;gap:6px;margin-top:10px;flex-wrap:wrap}
.brief-alert{
  background:rgba(79,156,249,.1);border:1px solid rgba(79,156,249,.2);
  border-radius:5px;padding:3px 9px;font-size:.68rem;color:var(--accent2);
}
/* â”€â”€ ì¼ì¶œ/ì¼ëª° ì•„í¬ â”€â”€ */
.sun-arc-wrap{width:100%;height:120px;margin:4px 0 8px;position:relative}
.sun-arc-svg{width:100%;height:100%;overflow:visible}

/* â”€â”€ 30ì¼ ìº˜ë¦°ë” â”€â”€ */
.cal-card{
  background:var(--surface);border:1px solid var(--border);
  border-radius:16px;padding:22px;margin-bottom:20px;animation:fadeUp .5s ease;
}
.cal-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:16px}
.cal-title{font-size:.66rem;letter-spacing:.12em;text-transform:uppercase;color:var(--muted)}
.cal-month-nav{display:flex;align-items:center;gap:10px}
.cal-month-label{font-family:'DM Serif Display',serif;font-size:1rem;min-width:100px;text-align:center}
.cal-nav-btn{
  background:var(--surface2);border:1px solid var(--border);
  border-radius:6px;padding:4px 10px;color:var(--muted);
  cursor:pointer;font-size:.8rem;transition:all .2s;
}
.cal-nav-btn:hover{border-color:var(--accent);color:var(--accent)}
.cal-nav-btn:disabled{opacity:.3;cursor:not-allowed}
.cal-grid{display:grid;grid-template-columns:repeat(7,1fr);gap:4px}
.cal-dow{
  text-align:center;font-size:.62rem;color:var(--muted);
  letter-spacing:.08em;text-transform:uppercase;padding:4px 0 8px;
}
.cal-dow:first-child{color:#f87171}
.cal-dow:last-child{color:#818cf8}
.cal-cell{
  background:var(--surface2);border:1px solid var(--border);
  border-radius:10px;padding:7px 5px;text-align:center;
  min-height:80px;position:relative;transition:all .2s;cursor:default;
  display:flex;flex-direction:column;align-items:center;gap:2px;
}
.cal-cell:hover:not(.cal-empty):not(.cal-past){
  border-color:var(--accent);transform:translateY(-2px);
  box-shadow:0 4px 16px rgba(79,156,249,.15);z-index:2;
}
.cal-cell.cal-today{
  border-color:var(--accent);
  background:rgba(79,156,249,.08);
}
.cal-cell.cal-today .cal-day-num{color:var(--accent);font-weight:600}
.cal-cell.cal-past{opacity:.35}
.cal-cell.cal-empty{background:transparent;border-color:transparent;cursor:default}
.cal-cell.cal-future-fade{opacity:.7}
.cal-day-num{font-size:.75rem;color:var(--muted);line-height:1;margin-bottom:1px}
.cal-ico{font-size:1.3rem;line-height:1}
.cal-hi{font-size:.78rem;color:var(--text);font-weight:500;line-height:1.2}
.cal-lo{font-size:.68rem;color:var(--muted);line-height:1}
.cal-pp{
  font-size:.58rem;color:var(--accent);
  position:absolute;bottom:5px;right:6px;
}
.cal-precip-bar{
  width:70%;height:2px;border-radius:1px;margin-top:2px;
  background:rgba(79,156,249,.15);position:relative;overflow:hidden;
}
.cal-precip-fill{
  position:absolute;left:0;top:0;height:100%;border-radius:1px;
  background:rgba(79,156,249,.7);transition:width .4s;
}
.cal-legend{display:flex;gap:16px;margin-top:12px;flex-wrap:wrap}
.cal-legend-item{display:flex;align-items:center;gap:5px;font-size:.68rem;color:var(--muted)}
.cal-legend-dot{width:8px;height:8px;border-radius:50%}
@media(max-width:600px){
  .cal-cell{min-height:64px;padding:5px 3px;border-radius:7px}
  .cal-ico{font-size:1.1rem}
  .cal-hi{font-size:.7rem}
  .cal-lo{font-size:.62rem}
  .cal-pp{display:none}
  .grid-2,.grid-3{grid-template-columns:1fr}
  .aqi-hero{flex-direction:column}
  .aqi-score-block{flex-direction:row;gap:16px;padding:14px 16px}
  .pm-row{grid-template-columns:repeat(3,1fr)}
  .aqi-action-row{grid-template-columns:repeat(3,1fr)}
}


</style>
</head>
<body class="wx-cloudy">
<div class="titlebar-drag"></div>
<div class="bg-orb bg-orb-1"></div>
<div class="bg-orb bg-orb-2"></div>
<div class="rain-container" id="rainContainer"></div>
<div class="snow-container" id="snowContainer"></div>

<div class="app">
  <!-- HEADER -->
  <header>
    <div class="logo" onclick="goHome()" style="cursor:pointer;user-select:none">HWANG<span>'s</span> WEATHER</div>
    <div class="search-wrap">
      <input type="text" id="si" placeholder="ë„ì‹œ ê²€ìƒ‰..." autocomplete="off" spellcheck="false">
      <button class="search-btn" onclick="doSearch()">âŒ•</button>
      <div class="autocomplete" id="ac"></div>
    </div>
    <div class="header-right">
      <button class="loc-btn" onclick="getLoc()">â—‰ <span data-t="myLoc">ë‚´ ìœ„ì¹˜</span></button>
      <button class="loc-btn" onclick="addFav()" title="í˜„ì¬ ë„ì‹œ ì¦ê²¨ì°¾ê¸°" style="padding:9px 12px">â­</button>
      <button class="compare-btn" id="compareBtn" onclick="toggleCompare()">âŠ <span data-t="compare">ë„ì‹œ ë¹„êµ</span></button>
      <button class="lang-btn" onclick="switchLang('ko')" id="langKo">í•œêµ­ì–´</button>
      <button class="lang-btn active" id="langEn" onclick="switchLang('en')" style="display:none">English</button>
    </div>
  </header>

  <!-- ì¦ê²¨ì°¾ê¸° ë°” -->
  <div class="fav-bar" id="favBar"></div>

  <!-- COMPARE PANEL -->
  <div class="compare-panel" id="comparePanel">
    <div class="compare-header">
      <span class="compare-title" data-t="compareTitle">ë„ì‹œ ë¹„êµ ëª¨ë“œ</span>
    </div>
    <div class="compare-searches">
      <div class="compare-search">
        <input type="text" id="cmp1" placeholder="ì²« ë²ˆì§¸ ë„ì‹œ..." oninput="cmpSearch(1)" onkeydown="cmpKey(event,1)" autocomplete="off">
        <div class="compare-ac" id="cmpAc1"></div>
      </div>
      <div class="compare-search">
        <input type="text" id="cmp2" placeholder="ë‘ ë²ˆì§¸ ë„ì‹œ..." oninput="cmpSearch(2)" onkeydown="cmpKey(event,2)" autocomplete="off">
        <div class="compare-ac" id="cmpAc2"></div>
      </div>
    </div>
    <div class="compare-result" id="cmpResult">
      <div class="cmp-card" id="cmpCard1"></div>
      <div class="vs-badge">VS</div>
      <div class="cmp-card" id="cmpCard2"></div>
    </div>
  </div>

  <!-- MAIN CONTENT -->
  <div id="content">
    <div class="state-msg">
      <span class="icon">â›…</span>
      <span data-t="welcome">ë„ì‹œë¥¼ ê²€ìƒ‰í•˜ê±°ë‚˜ ë‚´ ìœ„ì¹˜ ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”</span><br>
      <small style="color:var(--muted);font-size:.75rem">ì„œìš¸ Â· ë¶€ì‚° Â· ë„ì¿„ Â· ë‰´ìš• Â· ëŸ°ë˜ Â· íŒŒë¦¬ ë“± 65ê°œ ë„ì‹œ</small>
    </div>
  </div>
</div>

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ë‹¤êµ­ì–´ (i18n)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let LANG = 'ko';
const T = {
  ko: {
    myLoc:'ë‚´ ìœ„ì¹˜', compare:'ë„ì‹œ ë¹„êµ', compareTitle:'ë„ì‹œ ë¹„êµ ëª¨ë“œ',
    welcome:'ë„ì‹œë¥¼ ê²€ìƒ‰í•˜ê±°ë‚˜ ë‚´ ìœ„ì¹˜ ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”',
    loading:'ë‚ ì”¨ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...',
    searchPlaceholder:'ë„ì‹œ ê²€ìƒ‰ (ì„œìš¸, ë¶€ì‚°, Tokyo, New York...)',
    today:'ì˜¤ëŠ˜', tomorrow:'ë‚´ì¼',
    days:['ì¼','ì›”','í™”','ìˆ˜','ëª©','ê¸ˆ','í† '],
    feels:'ì²´ê°ì˜¨ë„', humidity:'ìŠµë„', uv:'UV ì§€ìˆ˜', precip:'ê°•ìˆ˜ëŸ‰',
    hourly:'ì‹œê°„ë³„ ì˜ˆë³´ (24ì‹œê°„)', weekly:'7ì¼ ì˜ˆë³´', aqi:'ëŒ€ê¸°ì§ˆ (AQI)',
    sunrise:'ì¼ì¶œ', sunset:'ì¼ëª°', wind:'ë°”ëŒ', pressure:'ê¸°ì••',
    visibility:'ê°€ì‹œê±°ë¦¬', windDir:'ë°©í–¥',
    precipChart:'ê°•ìˆ˜ í™•ë¥  ì°¨íŠ¸ (48ì‹œê°„)',
    outfit:'ì˜¤ëŠ˜ì˜ ì˜·ì°¨ë¦¼ ì¶”ì²œ',
    modelLabel:{kma_seamless:'ğŸ‡°ğŸ‡· KMA ê¸°ìƒì²­',jma_seamless:'ğŸ‡¯ğŸ‡µ JMA ì¼ë³¸ê¸°ìƒì²­',best_match:'ğŸŒ ìë™ ìµœì '},
    aqiLevels:{good:'ì¢‹ìŒ',moderate:'ë³´í†µ',bad:'ë‚˜ì¨',vbad:'ë§¤ìš° ë‚˜ì¨'},
    aqiDesc:{
      good:'ê³µê¸°ê°€ ë§‘ìŠµë‹ˆë‹¤. ì•¼ì™¸ í™œë™ì— ìµœì ì…ë‹ˆë‹¤.',
      moderate:'ë³´í†µ ìˆ˜ì¤€. ë¯¼ê°í•œ ë¶„ë“¤ì€ ì£¼ì˜í•˜ì„¸ìš”.',
      bad:'ë¯¼ê°í•œ ê·¸ë£¹ì€ ì•¼ì™¸ í™œë™ì„ ì¤„ì´ì„¸ìš”.',
      vbad:'ëª¨ë“  ì‚¬ëŒì´ ì˜í–¥ë°›ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì™¸ì¶œì„ ìì œí•˜ì„¸ìš”.'
    },
    compareFirstPH:'ì²« ë²ˆì§¸ ë„ì‹œ...',compareSecondPH:'ë‘ ë²ˆì§¸ ë„ì‹œ...',
    hPa:'ê¸°ì••', km:'km ê°€ì‹œê±°ë¦¬',
  },
  en: {
    myLoc:'My Location', compare:'Compare', compareTitle:'City Comparison',
    welcome:'Search a city or tap My Location',
    loading:'Loading weather...',
    searchPlaceholder:'Search city (Seoul, Tokyo, New York...)',
    today:'Today', tomorrow:'Tomorrow',
    days:['Sun','Mon','Tue','Wed','Thu','Fri','Sat'],
    feels:'Feels Like', humidity:'Humidity', uv:'UV Index', precip:'Precip',
    hourly:'Hourly Forecast (24h)', weekly:'7-Day Forecast', aqi:'Air Quality (AQI)',
    sunrise:'Sunrise', sunset:'Sunset', wind:'Wind', pressure:'Pressure',
    visibility:'Visibility', windDir:'Dir',
    precipChart:'Precipitation Chart (48h)',
    outfit:'Today\'s Outfit',
    modelLabel:{kma_seamless:'ğŸ‡°ğŸ‡· KMA Model',jma_seamless:'ğŸ‡¯ğŸ‡µ JMA Model',best_match:'ğŸŒ Auto Best'},
    aqiLevels:{good:'Good',moderate:'Moderate',bad:'Unhealthy',vbad:'Very Unhealthy'},
    aqiDesc:{
      good:'Air quality is satisfactory. Great for outdoor activities.',
      moderate:'Acceptable. Sensitive groups should limit prolonged exposure.',
      bad:'Unhealthy for sensitive groups. Reduce outdoor activities.',
      vbad:'Very unhealthy. Everyone may experience health effects.'
    },
    compareFirstPH:'First city...',compareSecondPH:'Second city...',
    hPa:'hPa Pressure', km:'km Visibility',
  }
};
function t(key){ return T[LANG][key] || key }
function switchLang(lang){
  LANG = lang;
  document.getElementById('langKo').style.display = lang==='ko'?'none':'';
  document.getElementById('langEn').style.display = lang==='en'?'none':'';
  document.getElementById('langKo').classList.toggle('active', lang==='ko');
  document.getElementById('langEn').classList.toggle('active', lang==='en');
  document.querySelectorAll('[data-t]').forEach(el=>{
    const key = el.getAttribute('data-t');
    if(T[LANG][key]) el.textContent = T[LANG][key];
  });
  document.getElementById('si').placeholder = t('searchPlaceholder');
  document.getElementById('cmp1').placeholder = t('compareFirstPH');
  document.getElementById('cmp2').placeholder = t('compareSecondPH');
  renderFavBar();
  if(lastWeatherData) render(lastWeatherData.w, lastWeatherData.aq, lastWeatherData.n, lastWeatherData.e, lastWeatherData.f, lastWeatherData.model, lastWeatherData.w30);
}

function goHome(){
  document.getElementById("content").innerHTML = `
    <div class="state-msg">
      <span class="icon">â›…</span>
      <span>${t("welcome")}</span><br>
      <small style="color:var(--muted);font-size:.75rem">ì„œìš¸ Â· ë¶€ì‚° Â· ë„ì¿„ Â· ë‰´ìš• Â· ëŸ°ë˜ Â· íŒŒë¦¬ ë“± 65ê°œ ë„ì‹œ</small>
    </div>`;
  document.getElementById("si").value = "";
  lastWeatherData = null;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ë„ì‹œ DB
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const CITIES = [
  {n:'ì„œìš¸',e:'Seoul',f:'ğŸ‡°ğŸ‡·',la:37.5714,lo:126.9658},
  {n:'ë¶€ì‚°',e:'Busan',f:'ğŸ‡°ğŸ‡·',la:35.1040,lo:129.0323},
  {n:'ì¸ì²œ',e:'Incheon',f:'ğŸ‡°ğŸ‡·',la:37.4776,lo:126.6249},
  {n:'ëŒ€êµ¬',e:'Daegu',f:'ğŸ‡°ğŸ‡·',la:35.8839,lo:128.6144},
  {n:'ëŒ€ì „',e:'Daejeon',f:'ğŸ‡°ğŸ‡·',la:36.3504,lo:127.3845},
  {n:'ê´‘ì£¼',e:'Gwangju',f:'ğŸ‡°ğŸ‡·',la:35.1595,lo:126.8526},
  {n:'ìˆ˜ì›',e:'Suwon',f:'ğŸ‡°ğŸ‡·',la:37.2636,lo:127.0286},
  {n:'ìš¸ì‚°',e:'Ulsan',f:'ğŸ‡°ğŸ‡·',la:35.5384,lo:129.3114},
  {n:'ì œì£¼',e:'Jeju',f:'ğŸ‡°ğŸ‡·',la:33.5141,lo:126.5290},
  {n:'ì²­ì£¼',e:'Cheongju',f:'ğŸ‡°ğŸ‡·',la:36.6424,lo:127.4890},
  {n:'ì „ì£¼',e:'Jeonju',f:'ğŸ‡°ğŸ‡·',la:35.8242,lo:127.1480},
  {n:'ì¶˜ì²œ',e:'Chuncheon',f:'ğŸ‡°ğŸ‡·',la:37.8813,lo:127.7298},
  {n:'ê°•ë¦‰',e:'Gangneung',f:'ğŸ‡°ğŸ‡·',la:37.7510,lo:128.8906},
  {n:'í¬í•­',e:'Pohang',f:'ğŸ‡°ğŸ‡·',la:36.0190,lo:129.3435},
  {n:'ì°½ì›',e:'Changwon',f:'ğŸ‡°ğŸ‡·',la:35.2281,lo:128.6811},
  {n:'ë„ì¿„',e:'Tokyo',f:'ğŸ‡¯ğŸ‡µ',la:35.6762,lo:139.6503},
  {n:'ì˜¤ì‚¬ì¹´',e:'Osaka',f:'ğŸ‡¯ğŸ‡µ',la:34.6937,lo:135.5023},
  {n:'ì‚¿í¬ë¡œ',e:'Sapporo',f:'ğŸ‡¯ğŸ‡µ',la:43.0621,lo:141.3544},
  {n:'í›„ì¿ ì˜¤ì¹´',e:'Fukuoka',f:'ğŸ‡¯ğŸ‡µ',la:33.5904,lo:130.4017},
  {n:'êµí† ',e:'Kyoto',f:'ğŸ‡¯ğŸ‡µ',la:35.0116,lo:135.7681},
  {n:'ë‚˜ê³ ì•¼',e:'Nagoya',f:'ğŸ‡¯ğŸ‡µ',la:35.1815,lo:136.9066},
  {n:'ë² ì´ì§•',e:'Beijing',f:'ğŸ‡¨ğŸ‡³',la:39.9042,lo:116.4074},
  {n:'ìƒí•˜ì´',e:'Shanghai',f:'ğŸ‡¨ğŸ‡³',la:31.2304,lo:121.4737},
  {n:'í™ì½©',e:'Hong Kong',f:'ğŸ‡­ğŸ‡°',la:22.3193,lo:114.1694},
  {n:'ì„ ì „',e:'Shenzhen',f:'ğŸ‡¨ğŸ‡³',la:22.5431,lo:114.0579},
  {n:'ë°©ì½•',e:'Bangkok',f:'ğŸ‡¹ğŸ‡­',la:13.7563,lo:100.5018},
  {n:'ì‹±ê°€í¬ë¥´',e:'Singapore',f:'ğŸ‡¸ğŸ‡¬',la:1.3521,lo:103.8198},
  {n:'ì¿ ì•Œë¼ë£¸í‘¸ë¥´',e:'Kuala Lumpur',f:'ğŸ‡²ğŸ‡¾',la:3.1390,lo:101.6869},
  {n:'ìì¹´ë¥´íƒ€',e:'Jakarta',f:'ğŸ‡®ğŸ‡©',la:-6.2088,lo:106.8456},
  {n:'í•˜ë…¸ì´',e:'Hanoi',f:'ğŸ‡»ğŸ‡³',la:21.0285,lo:105.8542},
  {n:'í˜¸ì¹˜ë¯¼',e:'Ho Chi Minh City',f:'ğŸ‡»ğŸ‡³',la:10.8231,lo:106.6297},
  {n:'ë§ˆë‹ë¼',e:'Manila',f:'ğŸ‡µğŸ‡­',la:14.5995,lo:120.9842},
  {n:'ë°œë¦¬',e:'Bali',f:'ğŸ‡®ğŸ‡©',la:-8.3405,lo:115.0920},
  {n:'ì¹˜ì•™ë§ˆì´',e:'Chiang Mai',f:'ğŸ‡¹ğŸ‡­',la:18.7883,lo:98.9853},
  {n:'ë‰´ìš•',e:'New York',f:'ğŸ‡ºğŸ‡¸',la:40.7128,lo:-74.0060},
  {n:'ë¡œìŠ¤ì•¤ì ¤ë ˆìŠ¤',e:'Los Angeles',f:'ğŸ‡ºğŸ‡¸',la:34.0522,lo:-118.2437},
  {n:'ìƒŒí”„ë€ì‹œìŠ¤ì½”',e:'San Francisco',f:'ğŸ‡ºğŸ‡¸',la:37.7749,lo:-122.4194},
  {n:'ì‹œì¹´ê³ ',e:'Chicago',f:'ğŸ‡ºğŸ‡¸',la:41.8781,lo:-87.6298},
  {n:'ë¼ìŠ¤ë² ê°€ìŠ¤',e:'Las Vegas',f:'ğŸ‡ºğŸ‡¸',la:36.1699,lo:-115.1398},
  {n:'ì‹œì• í‹€',e:'Seattle',f:'ğŸ‡ºğŸ‡¸',la:47.6062,lo:-122.3321},
  {n:'ë§ˆì´ì• ë¯¸',e:'Miami',f:'ğŸ‡ºğŸ‡¸',la:25.7617,lo:-80.1918},
  {n:'ì›Œì‹±í„´DC',e:'Washington DC',f:'ğŸ‡ºğŸ‡¸',la:38.9072,lo:-77.0369},
  {n:'í˜¸ë†€ë£°ë£¨',e:'Honolulu',f:'ğŸ‡ºğŸ‡¸',la:21.3069,lo:-157.8583},
  {n:'ë³´ìŠ¤í„´',e:'Boston',f:'ğŸ‡ºğŸ‡¸',la:42.3601,lo:-71.0589},
  {n:'ëŸ°ë˜',e:'London',f:'ğŸ‡¬ğŸ‡§',la:51.5074,lo:-0.1278},
  {n:'íŒŒë¦¬',e:'Paris',f:'ğŸ‡«ğŸ‡·',la:48.8566,lo:2.3522},
  {n:'ë² ë¥¼ë¦°',e:'Berlin',f:'ğŸ‡©ğŸ‡ª',la:52.5200,lo:13.4050},
  {n:'ë¡œë§ˆ',e:'Rome',f:'ğŸ‡®ğŸ‡¹',la:41.9028,lo:12.4964},
  {n:'ë§ˆë“œë¦¬ë“œ',e:'Madrid',f:'ğŸ‡ªğŸ‡¸',la:40.4168,lo:-3.7038},
  {n:'ì•”ìŠ¤í…Œë¥´ë‹´',e:'Amsterdam',f:'ğŸ‡³ğŸ‡±',la:52.3676,lo:4.9041},
  {n:'ë°”ë¥´ì…€ë¡œë‚˜',e:'Barcelona',f:'ğŸ‡ªğŸ‡¸',la:41.3851,lo:2.1734},
  {n:'í”„ë¼í•˜',e:'Prague',f:'ğŸ‡¨ğŸ‡¿',la:50.0755,lo:14.4378},
  {n:'ë¹„ì—”ë‚˜',e:'Vienna',f:'ğŸ‡¦ğŸ‡¹',la:48.2082,lo:16.3738},
  {n:'ì·¨ë¦¬íˆ',e:'Zurich',f:'ğŸ‡¨ğŸ‡­',la:47.3769,lo:8.5417},
  {n:'ë®Œí—¨',e:'Munich',f:'ğŸ‡©ğŸ‡ª',la:48.1351,lo:11.5820},
  {n:'ì´ìŠ¤íƒ„ë¶ˆ',e:'Istanbul',f:'ğŸ‡¹ğŸ‡·',la:41.0082,lo:28.9784},
  {n:'ë”ë¸”ë¦°',e:'Dublin',f:'ğŸ‡®ğŸ‡ª',la:53.3498,lo:-6.2603},
  {n:'ì‹œë“œë‹ˆ',e:'Sydney',f:'ğŸ‡¦ğŸ‡º',la:-33.8688,lo:151.2093},
  {n:'ë©œë²„ë¥¸',e:'Melbourne',f:'ğŸ‡¦ğŸ‡º',la:-37.8136,lo:144.9631},
  {n:'ì˜¤í´ëœë“œ',e:'Auckland',f:'ğŸ‡³ğŸ‡¿',la:-36.8509,lo:174.7645},
  {n:'ë‘ë°”ì´',e:'Dubai',f:'ğŸ‡¦ğŸ‡ª',la:25.2048,lo:55.2708},
  {n:'ë„í•˜',e:'Doha',f:'ğŸ‡¶ğŸ‡¦',la:25.2854,lo:51.5310},
  {n:'ìƒíŒŒìš¸ë£¨',e:'Sao Paulo',f:'ğŸ‡§ğŸ‡·',la:-23.5505,lo:-46.6333},
  {n:'ë¶€ì—ë…¸ìŠ¤ì•„ì´ë ˆìŠ¤',e:'Buenos Aires',f:'ğŸ‡¦ğŸ‡·',la:-34.6037,lo:-58.3816},
  {n:'ë¦¬ìš°ë°ìë„¤ì´ë£¨',e:'Rio de Janeiro',f:'ğŸ‡§ğŸ‡·',la:-22.9068,lo:-43.1729},
  {n:'ë­„ë°”ì´',e:'Mumbai',f:'ğŸ‡®ğŸ‡³',la:19.0760,lo:72.8777},
  {n:'ë‰´ë¸ë¦¬',e:'New Delhi',f:'ğŸ‡®ğŸ‡³',la:28.6139,lo:77.2090},
  {n:'ì¹´ì´ë¡œ',e:'Cairo',f:'ğŸ‡ªğŸ‡¬',la:30.0444,lo:31.2357},
  {n:'ë‚˜ì´ë¡œë¹„',e:'Nairobi',f:'ğŸ‡°ğŸ‡ª',la:-1.2921,lo:36.8219},
  {n:'í† ë¡ í† ',e:'Toronto',f:'ğŸ‡¨ğŸ‡¦',la:43.6532,lo:-79.3832},
  {n:'ë°´ì¿ ë²„',e:'Vancouver',f:'ğŸ‡¨ğŸ‡¦',la:49.2827,lo:-123.1207},
  {n:'ë©•ì‹œì½”ì‹œí‹°',e:'Mexico City',f:'ğŸ‡²ğŸ‡½',la:19.4326,lo:-99.1332},
];

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ë‚ ì”¨ ì½”ë“œ ë°ì´í„°
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const WMO_KO={0:'ë§‘ìŒ',1:'ëŒ€ì²´ë¡œ ë§‘ìŒ',2:'ë¶€ë¶„ íë¦¼',3:'íë¦¼',45:'ì•ˆê°œ',48:'ì„œë¦¬ ì•ˆê°œ',51:'ì´ìŠ¬ë¹„',53:'ì´ìŠ¬ë¹„',55:'ê°•í•œ ì´ìŠ¬ë¹„',61:'ë¹„',63:'ë¹„',65:'ê°•í•œ ë¹„',71:'ëˆˆ',73:'ëˆˆ',75:'ê°•í•œ ëˆˆ',77:'ëˆˆì‹¸ë¼ê¸°',80:'ì†Œë‚˜ê¸°',81:'ê°•í•œ ì†Œë‚˜ê¸°',82:'í­ìš°',85:'ëˆˆ ì†Œë‚˜ê¸°',86:'ê°•í•œ ëˆˆ ì†Œë‚˜ê¸°',95:'ë‡Œìš°',96:'ë‡Œìš°',99:'ê°•í•œ ë‡Œìš°'};
const WMO_EN={0:'Clear',1:'Mostly Clear',2:'Partly Cloudy',3:'Overcast',45:'Fog',48:'Icy Fog',51:'Drizzle',53:'Drizzle',55:'Heavy Drizzle',61:'Rain',63:'Rain',65:'Heavy Rain',71:'Snow',73:'Snow',75:'Heavy Snow',77:'Snow Grains',80:'Showers',81:'Heavy Showers',82:'Violent Showers',85:'Snow Showers',86:'Heavy Snow Showers',95:'Thunderstorm',96:'Thunderstorm',99:'Heavy Thunderstorm'};
const ICO={0:'â˜€ï¸',1:'ğŸŒ¤ï¸',2:'â›…',3:'â˜ï¸',45:'ğŸŒ«ï¸',48:'ğŸŒ«ï¸',51:'ğŸŒ¦ï¸',53:'ğŸŒ¦ï¸',55:'ğŸŒ§ï¸',61:'ğŸŒ§ï¸',63:'ğŸŒ§ï¸',65:'ğŸŒ§ï¸',71:'â„ï¸',73:'ğŸŒ¨ï¸',75:'â„ï¸',77:'ğŸŒ¨ï¸',80:'ğŸŒ¦ï¸',81:'ğŸŒ§ï¸',82:'â›ˆï¸',85:'ğŸŒ¨ï¸',86:'ğŸŒ¨ï¸',95:'â›ˆï¸',96:'â›ˆï¸',99:'â›ˆï¸'};

// ë‚ ì”¨ ì½”ë“œ â†’ ë°°ê²½ í…Œë§ˆ ë§¤í•‘
function wxClass(code){
  if([0,1].includes(code)) return 'wx-clear';
  if([2,3].includes(code)) return 'wx-cloudy';
  if([45,48].includes(code)) return 'wx-fog';
  if(code>=51&&code<=82) return 'wx-rain';
  if(code>=71&&code<=77||code>=85&&code<=86) return 'wx-snow';
  if(code>=95) return 'wx-thunder';
  return 'wx-cloudy';
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ë‚ ì”¨ ë°°ê²½ + íŒŒí‹°í´ íš¨ê³¼
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function applyWeatherTheme(code){
  const cls = wxClass(code);
  const body = document.body;
  ['wx-clear','wx-cloudy','wx-rain','wx-snow','wx-fog','wx-thunder'].forEach(c=>body.classList.remove(c));
  body.classList.add(cls);

  // Rain drops
  const rainC = document.getElementById('rainContainer');
  rainC.innerHTML = '';
  if(cls === 'wx-rain'){
    for(let i=0;i<60;i++){
      const drop = document.createElement('div');
      drop.className = 'raindrop';
      drop.style.cssText = `left:${Math.random()*100}%;height:${10+Math.random()*20}px;animation-duration:${0.4+Math.random()*0.6}s;animation-delay:${-Math.random()*2}s;opacity:${0.3+Math.random()*0.4}`;
      rainC.appendChild(drop);
    }
  }

  // Snowflakes
  const snowC = document.getElementById('snowContainer');
  snowC.innerHTML = '';
  if(cls === 'wx-snow'){
    for(let i=0;i<40;i++){
      const flake = document.createElement('div');
      flake.className = 'snowflake';
      flake.textContent = 'â„';
      flake.style.cssText = `left:${Math.random()*100}%;font-size:${8+Math.random()*12}px;animation-duration:${3+Math.random()*5}s;animation-delay:${-Math.random()*8}s;opacity:${0.3+Math.random()*0.4}`;
      snowC.appendChild(flake);
    }
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ì˜·ì°¨ë¦¼ ì¶”ì²œ ì—”ì§„
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function getOutfit(temp, code, humidity, windSpeed){
  const isRain = code>=51&&code<=82||code>=95;
  const isSnow = code>=71&&code<=77||code>=85;
  const isWind = windSpeed > 30;

  let icon, title, desc, tags;

  if(isSnow || temp <= -5){
    icon = 'ğŸ§¥'; 
    title = LANG==='ko' ? 'ë‘êº¼ìš´ íŒ¨ë”© / ë°©í•œ ì™„ì „ ë¬´ì¥' : 'Heavy Winter Coat';
    desc = LANG==='ko' ? 'ì²´ê°ì˜¨ë„ê°€ ë§¤ìš° ë‚®ìŠµë‹ˆë‹¤. ë‘êº¼ìš´ íŒ¨ë”©, ëª©ë„ë¦¬, ì¥ê°‘, í„¸ëª¨ìê¹Œì§€ í•„ìˆ˜ì…ë‹ˆë‹¤. ë‚´ë³µë„ ê³ ë ¤í•˜ì„¸ìš”.' : 'Very cold. Heavy coat, scarf, gloves and beanie are essential. Consider thermal underwear.';
    tags = LANG==='ko' ? ['ë‘êº¼ìš´ íŒ¨ë”©','ëª©ë„ë¦¬','ì¥ê°‘','í„¸ëª¨ì','ë‚´ë³µ','ë°©ìˆ˜ ë¶€ì¸ '] : ['Heavy Coat','Scarf','Gloves','Beanie','Thermal','Waterproof Boots'];
  } else if(temp <= 4){
    icon = 'ğŸ§¤';
    title = LANG==='ko' ? 'íŒ¨ë”© / ë‘êº¼ìš´ ì™¸íˆ¬' : 'Puffer / Winter Jacket';
    desc = LANG==='ko' ? 'ë§¤ìš° ì¶¥ìŠµë‹ˆë‹¤. íŒ¨ë”© ë˜ëŠ” ë‘êº¼ìš´ ì½”íŠ¸ê°€ í•„ìš”í•˜ë©° ëª©ë„ë¦¬ì™€ ì¥ê°‘ì„ ì±™ê¸°ì„¸ìš”.' : 'Very cold. Puffer jacket or heavy coat needed. Don\'t forget scarf and gloves.';
    tags = LANG==='ko' ? ['íŒ¨ë”©','ë‘êº¼ìš´ ì½”íŠ¸','ëª©ë„ë¦¬','ì¥ê°‘','ë‘êº¼ìš´ ë‹ˆíŠ¸'] : ['Puffer','Heavy Coat','Scarf','Gloves','Thick Knit'];
  } else if(temp <= 11){
    icon = 'ğŸ§£';
    title = LANG==='ko' ? 'ìì¼“ + ë ˆì´ì–´ë§ í•„ìˆ˜' : 'Jacket + Layering';
    desc = LANG==='ko' ? 'ìŒ€ìŒ€í•œ ë‚ ì”¨ì…ë‹ˆë‹¤. ì–‡ì€ íŒ¨ë”©ì´ë‚˜ ë‘êº¼ìš´ ìì¼“ì— ì´ë„ˆë¥¼ ë ˆì´ì–´ë“œ í•´ì£¼ì„¸ìš”.' : 'Chilly weather. Light puffer or thick jacket with inner layers recommended.';
    tags = LANG==='ko' ? ['ì–‡ì€ íŒ¨ë”©','ë‘êº¼ìš´ ìì¼“','í›„ë“œí‹°','ë ˆì´ì–´ë§','ê¸´ ë°”ì§€'] : ['Light Puffer','Thick Jacket','Hoodie','Layering','Pants'];
  } else if(temp <= 16){
    icon = 'ğŸ§¥';
    title = LANG==='ko' ? 'íŠ¸ë Œì¹˜ì½”íŠ¸ / ê°€ì„ ìì¼“' : 'Trench Coat / Autumn Jacket';
    desc = LANG==='ko' ? 'ì•½ê°„ ìŒ€ìŒ€í•œ ë‚ ì”¨ì…ë‹ˆë‹¤. ê°€ë²¼ìš´ ì™¸íˆ¬ê°€ í•„ìš”í•˜ë©° ì¼êµì°¨ë¥¼ ëŒ€ë¹„í•˜ì„¸ìš”.' : 'Slightly cool. A light jacket needed, watch out for temperature swings.';
    tags = LANG==='ko' ? ['íŠ¸ë Œì¹˜ì½”íŠ¸','ê°€ë²¼ìš´ ìì¼“','ë§¨íˆ¬ë§¨','ê¸´íŒ”','ì²­ë°”ì§€'] : ['Trench Coat','Light Jacket','Sweatshirt','Long Sleeve','Jeans'];
  } else if(temp <= 21){
    icon = 'ğŸ‘•';
    title = LANG==='ko' ? 'ê°€ë””ê±´ / ê¸´íŒ” í‹°ì…”ì¸ ' : 'Cardigan / Long Sleeve';
    desc = LANG==='ko' ? 'ë´„ê°€ì„ ë‚ ì”¨ì²˜ëŸ¼ ì„ ì„ í•©ë‹ˆë‹¤. ê°€ë””ê±´ì´ë‚˜ ì–‡ì€ ê¸´íŒ”ì´ë©´ ì¶©ë¶„í•©ë‹ˆë‹¤.' : 'Pleasant weather. A cardigan or thin long sleeve should be enough.';
    tags = LANG==='ko' ? ['ê°€ë””ê±´','ê¸´íŒ” í‹°ì…”ì¸ ','ë©´ë°”ì§€','ì–‡ì€ ì›í”¼ìŠ¤'] : ['Cardigan','Long Sleeve','Chinos','Light Dress'];
  } else if(temp <= 27){
    icon = 'ğŸ‘”';
    title = LANG==='ko' ? 'ë°˜íŒ” í‹°ì…”ì¸  / ê°€ë²¼ìš´ ì…”ì¸ ' : 'T-Shirt / Light Shirt';
    desc = LANG==='ko' ? 'ë”°ëœ»í•˜ê³  í™œë™í•˜ê¸° ì¢‹ì€ ë‚ ì”¨ì…ë‹ˆë‹¤. ë°˜íŒ”ë¡œ í¸í•˜ê²Œ ì…ìœ¼ì„¸ìš”.' : 'Warm and pleasant. A T-shirt or light shirt will do great.';
    tags = LANG==='ko' ? ['ë°˜íŒ” í‹°ì…”ì¸ ','ì–‡ì€ ì…”ì¸ ','ë©´ë°”ì§€','ë°˜ë°”ì§€'] : ['T-Shirt','Light Shirt','Chinos','Shorts'];
  } else {
    icon = 'ğŸ©³';
    title = LANG==='ko' ? 'ë°˜íŒ” + ë°˜ë°”ì§€ / ì—¬ë¦„ ë³µì¥' : 'Tank Top / Summer Wear';
    desc = LANG==='ko' ? 'ë¥ê³  ë¬´ë”ìš´ ë‚ ì”¨ì…ë‹ˆë‹¤. ê°€ë³ê³  í†µí’ì´ ì˜ ë˜ëŠ” ì˜·ì„ ì…ê³  ìì™¸ì„  ì°¨ë‹¨ì œë¥¼ ë°”ë¥´ì„¸ìš”.' : 'Hot and humid. Wear light, breathable clothing and apply sunscreen.';
    tags = LANG==='ko' ? ['ë°˜íŒ”','ë°˜ë°”ì§€','ì›í”¼ìŠ¤','ì„ ê¸€ë¼ìŠ¤','ìì™¸ì„ ì°¨ë‹¨ì œ'] : ['T-Shirt','Shorts','Dress','Sunglasses','Sunscreen'];
  }

  // ë¹„ ì¶”ê°€ ì–´ë“œë°”ì´ìŠ¤
  if(isRain){
    tags.push(LANG==='ko'?'ìš°ì‚°':'Umbrella');
    tags.push(LANG==='ko'?'ë°©ìˆ˜ ìì¼“':'Rain Jacket');
    desc += (LANG==='ko' ? ' ë¹„ê°€ ì˜¤ë‹ˆ ìš°ì‚°ì„ ê¼­ ì±™ê¸°ì„¸ìš”!' : ' Rain expected â€” bring an umbrella!');
  }
  if(isWind) tags.push(LANG==='ko'?'ë°”ëŒë§‰ì´':'Windbreaker');

  // íŒ¨ì…˜ ì•„ì´í…œ ë°ì´í„°

  // â”€â”€ ì‹¬í”Œ ë¹„ì£¼ì–¼ ë°ì´í„°
  let bigEmoji, pills, tip, bg, accent, border, color, tempLabel;
  const isKo2 = LANG === 'ko';

  if(isSnow || temp <= -5){
    bigEmoji = 'ğŸ§¥â„ï¸';
    pills = isKo2
      ? [{e:'ğŸ§¥',n:'ë‘êº¼ìš´ íŒ¨ë”©'},{e:'ğŸ§¤',n:'ì¥ê°‘'},{e:'ğŸ§£',n:'ëª©ë„ë¦¬'},{e:'ğŸ¥¾',n:'ë°©ìˆ˜ ë¶€ì¸ '}]
      : [{e:'ğŸ§¥',n:'Heavy Puffer'},{e:'ğŸ§¤',n:'Gloves'},{e:'ğŸ§£',n:'Scarf'},{e:'ğŸ¥¾',n:'Snow Boots'}];
    tip    = isKo2 ? 'ë‚´ë³µê¹Œì§€ ì±™ê¸°ë©´ ì™„ë²½í•´ìš” ğŸŒ¡ï¸' : 'Thermal layer underneath = perfect â„ï¸';
    bg     = 'rgba(30,58,138,.08)'; accent = 'rgba(96,165,250,.2)';
    border = 'rgba(96,165,250,.35)'; color  = '#93c5fd';
    tempLabel = isKo2 ? 'ğŸ¥¶ ê·¹í•œ ì¶”ìœ„' : 'ğŸ¥¶ Extreme Cold';
  } else if(temp <= 4){
    bigEmoji = 'ğŸ§¥ğŸ§¤';
    pills = isKo2
      ? [{e:'ğŸ§¥',n:'íŒ¨ë”© / ì½”íŠ¸'},{e:'ğŸ§£',n:'ëª©ë„ë¦¬'},{e:'ğŸ§¢',n:'ë¹„ë‹ˆ'},{e:'ğŸ‘¢',n:'ë¶€ì¸ '}]
      : [{e:'ğŸ§¥',n:'Puffer / Coat'},{e:'ğŸ§£',n:'Scarf'},{e:'ğŸ§¢',n:'Beanie'},{e:'ğŸ‘¢',n:'Boots'}];
    tip    = isKo2 ? 'ì¥ê°‘ì€ í•„ìˆ˜! ì†ì´ ë¨¼ì € ì‹œë ¤ìš” ğŸ§¤' : 'Gloves are a must â€” hands freeze first ğŸ§¤';
    bg     = 'rgba(29,78,216,.07)'; accent = 'rgba(99,102,241,.2)';
    border = 'rgba(99,102,241,.35)'; color  = '#a5b4fc';
    tempLabel = isKo2 ? 'ğŸŒ¨ï¸ ë§¤ìš° ì¶”ì›€' : 'ğŸŒ¨ï¸ Very Cold';
  } else if(temp <= 11){
    bigEmoji = 'ğŸ¥¼ğŸ‘–';
    pills = isKo2
      ? [{e:'ğŸ¥¼',n:'ìì¼“'},{e:'ğŸ‘•',n:'í›„ë“œí‹°'},{e:'ğŸ‘–',n:'ì²­ë°”ì§€'},{e:'ğŸ‘Ÿ',n:'ìŠ¤ë‹ˆì»¤ì¦ˆ'}]
      : [{e:'ğŸ¥¼',n:'Jacket'},{e:'ğŸ‘•',n:'Hoodie'},{e:'ğŸ‘–',n:'Jeans'},{e:'ğŸ‘Ÿ',n:'Sneakers'}];
    tip    = isKo2 ? 'ì•ˆì— ì–‡ì€ ì´ë„ˆ ë ˆì´ì–´ë§ ì¶”ì²œ ğŸ’¡' : 'Light inner layer recommended ğŸ’¡';
    bg     = 'rgba(55,65,81,.1)'; accent = 'rgba(156,163,175,.2)';
    border = 'rgba(156,163,175,.3)'; color  = '#d1d5db';
    tempLabel = isKo2 ? 'ğŸ‚ ìŒ€ìŒ€í•¨' : 'ğŸ‚ Chilly';
  } else if(temp <= 20){
    bigEmoji = 'ğŸ‘”ğŸŒ¿';
    pills = isKo2
      ? [{e:'ğŸ§¶',n:'ê°€ë””ê±´'},{e:'ğŸ‘•',n:'ê¸´íŒ”'},{e:'ğŸ‘–',n:'ë©´ë°”ì§€'},{e:'ğŸ¥¿',n:'ë¡œí¼'}]
      : [{e:'ğŸ§¶',n:'Cardigan'},{e:'ğŸ‘•',n:'Long Sleeve'},{e:'ğŸ‘–',n:'Chinos'},{e:'ğŸ¥¿',n:'Loafers'}];
    tip    = isKo2 ? 'ê°€ë””ê±´ í•˜ë‚˜ë©´ ì¶©ë¶„í•œ ë‚ ì”¨ì˜ˆìš” âœ¨' : 'A cardigan is all you need âœ¨';
    bg     = 'rgba(5,150,105,.06)'; accent = 'rgba(52,211,153,.2)';
    border = 'rgba(52,211,153,.3)'; color  = '#6ee7b7';
    tempLabel = isKo2 ? 'ğŸŒ¤ï¸ ì„ ì„ í•¨' : 'ğŸŒ¤ï¸ Mild';
  } else if(temp <= 27){
    bigEmoji = 'ğŸ‘•â˜€ï¸';
    pills = isKo2
      ? [{e:'ğŸ‘•',n:'ë°˜íŒ” í‹°'},{e:'ğŸ‘–',n:'ë©´ë°”ì§€'},{e:'ğŸ•¶ï¸',n:'ì„ ê¸€ë¼ìŠ¤'},{e:'ğŸ‘Ÿ',n:'ìš´ë™í™”'}]
      : [{e:'ğŸ‘•',n:'T-Shirt'},{e:'ğŸ‘–',n:'Pants'},{e:'ğŸ•¶ï¸',n:'Shades'},{e:'ğŸ‘Ÿ',n:'Sneakers'}];
    tip    = isKo2 ? 'ì„ í¬ë¦¼ ê¼­ ì±™ê¸°ì„¸ìš” â˜€ï¸ SPF50+' : 'Sunscreen is a must â˜€ï¸ SPF50+';
    bg     = 'rgba(245,158,11,.06)'; accent = 'rgba(251,191,36,.2)';
    border = 'rgba(251,191,36,.35)'; color  = '#fcd34d';
    tempLabel = isKo2 ? 'â˜€ï¸ ë”°ëœ»í•¨' : 'â˜€ï¸ Warm';
  } else {
    bigEmoji = 'ğŸ©³ğŸ”¥';
    pills = isKo2
      ? [{e:'ğŸ‘•',n:'ë¯¼ì†Œë§¤'},{e:'ğŸ©³',n:'ë°˜ë°”ì§€'},{e:'ğŸ©´',n:'ìƒŒë“¤'},{e:'ğŸ§´',n:'SPF100'}]
      : [{e:'ğŸ‘•',n:'Tank Top'},{e:'ğŸ©³',n:'Shorts'},{e:'ğŸ©´',n:'Sandals'},{e:'ğŸ§´',n:'SPF100'}];
    tip    = isKo2 ? 'ìˆ˜ë¶„ ë³´ì¶© ìì£¼! ì—´ì‚¬ë³‘ ì£¼ì˜ ğŸŒ¡ï¸' : 'Stay hydrated! Watch for heat stroke ğŸŒ¡ï¸';
    bg     = 'rgba(239,68,68,.07)'; accent = 'rgba(248,113,113,.2)';
    border = 'rgba(248,113,113,.35)'; color  = '#fca5a5';
    tempLabel = isKo2 ? 'ğŸ”¥ í­ì—¼' : 'ğŸ”¥ Heat Wave';
  }
  // ë¹„ ì˜¬ ë•Œ ìš°ì‚° ì¶”ê°€
  if(isRain){
    pills = [{e:'â˜‚ï¸', n: isKo2?'ìš°ì‚° í•„ìˆ˜':'Umbrella'}, ...pills.slice(0,3)];
    tip = (isKo2 ? 'â˜” ìš°ì‚° í•„ìˆ˜! ' : 'â˜” Bring umbrella! ') + tip;
  }

  return {icon, title, desc, tags, bigEmoji, pills, tip, bg, accent, border, color, tempLabel};
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ê°•ìˆ˜ í™•ë¥  ì°¨íŠ¸ (Canvas)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function drawPrecipChart(canvasId, hours, probs, temps){
  const canvas = document.getElementById(canvasId);
  if(!canvas) return;
  const ctx = canvas.getContext('2d');
  const W = canvas.offsetWidth;
  const H = canvas.offsetHeight;
  canvas.width = W * window.devicePixelRatio;
  canvas.height = H * window.devicePixelRatio;
  ctx.scale(window.devicePixelRatio, window.devicePixelRatio);
  ctx.clearRect(0,0,W,H);

  const PAD = {top:12, right:16, bottom:28, left:32};
  const chartW = W - PAD.left - PAD.right;
  const chartH = H - PAD.top - PAD.bottom;
  const n = Math.min(hours.length, 48);

  // Grid lines
  ctx.strokeStyle = 'rgba(255,255,255,0.05)';
  ctx.lineWidth = 1;
  [0,25,50,75,100].forEach(v=>{
    const y = PAD.top + chartH - (v/100)*chartH;
    ctx.beginPath(); ctx.moveTo(PAD.left,y); ctx.lineTo(PAD.left+chartW,y); ctx.stroke();
    ctx.fillStyle='rgba(90,100,120,0.8)';
    ctx.font='9px DM Mono';ctx.textAlign='right';
    ctx.fillText(v+'%', PAD.left-4, y+3);
  });

  // Precip bars
  const barW = chartW/n * 0.65;
  for(let i=0;i<n;i++){
    const x = PAD.left + (i/n)*chartW + (chartW/n*0.175);
    const prob = probs[i] || 0;
    const barH = (prob/100)*chartH;
    const y = PAD.top + chartH - barH;
    const alpha = 0.3 + (prob/100)*0.5;
    ctx.fillStyle = `rgba(79,156,249,${alpha})`;
    ctx.beginPath();
    ctx.roundRect ? ctx.roundRect(x, y, barW, barH, 2) : ctx.rect(x, y, barW, barH);
    ctx.fill();
  }

  // Temp line
  if(temps && temps.length >= n){
    const minT = Math.min(...temps.slice(0,n));
    const maxT = Math.max(...temps.slice(0,n));
    const rangeT = maxT - minT || 1;
    ctx.beginPath();
    ctx.strokeStyle = 'rgba(251,191,36,0.8)';
    ctx.lineWidth = 2;
    ctx.lineJoin = 'round';
    for(let i=0;i<n;i++){
      const x = PAD.left + (i/(n-1))*chartW;
      const norm = (temps[i]-minT)/rangeT;
      const y = PAD.top + chartH*(1-norm*0.7-0.1);
      i===0 ? ctx.moveTo(x,y) : ctx.lineTo(x,y);
    }
    ctx.stroke();
  }

  // X-axis labels (every 6h)
  ctx.fillStyle='rgba(90,100,120,0.9)';
  ctx.font='9px DM Mono';ctx.textAlign='center';
  for(let i=0;i<n;i+=6){
    const x = PAD.left + (i/n)*chartW + (chartW/n)*0.5;
    const h = new Date(hours[i]);
    ctx.fillText(h.getHours()+'ì‹œ', x, PAD.top+chartH+16);
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ê²€ìƒ‰
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function findCities(q){
  if(!q||q.length<1) return [];
  const ql = q.toLowerCase().replace(/\s/g,'');
  return CITIES.filter(c=>
    c.n.replace(/\s/g,'').includes(q.replace(/\s/g,'')) ||
    c.e.toLowerCase().replace(/\s/g,'').includes(ql)
  ).slice(0,8);
}

const inp = document.getElementById('si');
const acBox = document.getElementById('ac');
let acIdx = -1;

inp.addEventListener('input',()=>{
  acIdx=-1;
  renderAC(findCities(inp.value.trim()), acBox, (la,lo,n,e,f)=>pickCity(la,lo,n,e,f));
});
inp.addEventListener('keydown', e=>{
  const items = acBox.querySelectorAll('.auto-item');
  if(e.key==='ArrowDown'){e.preventDefault();acIdx=Math.min(acIdx+1,items.length-1);items.forEach((el,i)=>el.classList.toggle('selected',i===acIdx))}
  else if(e.key==='ArrowUp'){e.preventDefault();acIdx=Math.max(acIdx-1,0);items.forEach((el,i)=>el.classList.toggle('selected',i===acIdx))}
  else if(e.key==='Enter'){e.preventDefault();acIdx>=0&&items[acIdx]?items[acIdx].click():doSearch()}
  else if(e.key==='Escape') closeAC();
});
document.addEventListener('click',e=>{if(!e.target.closest('.search-wrap')&&!e.target.closest('.compare-panel')) closeAllAC()});

function renderAC(results, box, onSelect){
  if(!results.length){box.classList.remove('show');return}
  box.innerHTML = results.map(c=>
    `<div class="auto-item" onclick="(${onSelect.toString()})(${c.la},${c.lo},'${c.n.replace(/'/g,"\\'")}','${c.e.replace(/'/g,"\\'")}','${c.f}')">
      <span>${c.f}</span><span class="auto-city">${c.n}</span><span class="auto-eng">${c.e}</span>
    </div>`
  ).join('');
  box.classList.add('show');
}

function closeAC(){acBox.classList.remove('show');acIdx=-1}
function closeAllAC(){
  document.querySelectorAll('.autocomplete,.compare-ac').forEach(b=>b.classList.remove('show'));
  acIdx=-1;
}

function doSearch(){
  const q = inp.value.trim();
  if(!q) return;
  const results = findCities(q);
  if(results.length) pickCity(results[0].la,results[0].lo,results[0].n,results[0].e,results[0].f);
  else document.getElementById('content').innerHTML=`<div class="state-msg"><span class="icon">ğŸ”</span>"${q}" ë„ì‹œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤</div>`;
  closeAC();
}

async function pickCity(la,lo,n,e,f){
  inp.value = n; closeAC(); setLoading(n);
  await loadWeather(la,lo,n,e,f||'');
}

function getLoc(){
  if(!navigator.geolocation){setErr('ìœ„ì¹˜ ì •ë³´ë¥¼ ì§€ì›í•˜ì§€ ì•ŠëŠ” ë¸Œë¼ìš°ì €ì…ë‹ˆë‹¤.');return}
  setLoading('í˜„ì¬ ìœ„ì¹˜');
  navigator.geolocation.getCurrentPosition(async pos=>{
    const{latitude:la,longitude:lo}=pos.coords;
    let near=CITIES[0],min=99999;
    CITIES.forEach(c=>{const d=(c.la-la)**2+(c.lo-lo)**2;if(d<min){min=d;near=c}});
    inp.value=near.n;
    await loadWeather(la,lo,near.n,near.e,near.f);
  },()=>setErr('ìœ„ì¹˜ ê¶Œí•œì„ í—ˆìš©í•´ì£¼ì„¸ìš”.'));
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ë„ì‹œ ë¹„êµ ëª¨ë“œ
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let compareMode = false;
const cmpData = {1:null, 2:null};

function toggleCompare(){
  compareMode = !compareMode;
  document.getElementById('comparePanel').classList.toggle('show', compareMode);
  document.getElementById('compareBtn').classList.toggle('active', compareMode);
}

function cmpSearch(idx){
  const q = document.getElementById('cmp'+idx).value.trim();
  const ac = document.getElementById('cmpAc'+idx);
  const results = findCities(q);
  if(!results.length){ac.classList.remove('show');return}
  ac.innerHTML = results.map(c=>
    `<div class="auto-item" onclick="cmpPick(${idx},${c.la},${c.lo},'${c.n.replace(/'/g,"\\'")}','${c.e.replace(/'/g,"\\'")}','${c.f}')">
      <span>${c.f}</span><span class="auto-city">${c.n}</span><span class="auto-eng">${c.e}</span>
    </div>`
  ).join('');
  ac.classList.add('show');
}

function cmpKey(e,idx){if(e.key==='Enter'){e.preventDefault();const q=document.getElementById('cmp'+idx).value.trim();const r=findCities(q);if(r.length)cmpPick(idx,r[0].la,r[0].lo,r[0].n,r[0].e,r[0].f)}}

async function cmpPick(idx,la,lo,n,e,f){
  document.getElementById('cmp'+idx).value = n;
  document.getElementById('cmpAc'+idx).classList.remove('show');
  document.getElementById('cmpCard'+idx).innerHTML = '<div style="text-align:center;padding:20px;color:var(--muted)"><div class="spinner"></div></div>';
  document.getElementById('cmpResult').classList.add('show');

  try{
    const model = isKorea(la,lo)?'kma_seamless':isJapan(la,lo)?'jma_seamless':'best_match';
    const ts = Date.now();
    const wRes = await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${la}&longitude=${lo}&current=temperature_2m,relative_humidity_2m,apparent_temperature,weather_code,wind_speed_10m,precipitation&daily=temperature_2m_max,temperature_2m_min&timezone=auto&models=${model}&t=${ts}`,{cache:'no-store'});
    const w = await wRes.json();
    const c = w.current;
    const ico = ICO[c.weather_code]||'ğŸŒ¡ï¸';
    const dsc = (LANG==='ko'?WMO_KO:WMO_EN)[c.weather_code]||'';

    document.getElementById('cmpCard'+idx).innerHTML = `
      <div class="cmp-city">${f} ${n}</div>
      <div class="cmp-temp">${Math.round(c.temperature_2m)}Â°C</div>
      <div class="cmp-desc">${ico} ${dsc}</div>
      <div class="cmp-row"><span>${t('feels')}</span><span>${Math.round(c.apparent_temperature)}Â°C</span></div>
      <div class="cmp-row"><span>${t('humidity')}</span><span>${c.relative_humidity_2m}%</span></div>
      <div class="cmp-row"><span>${t('wind')}</span><span>${Math.round(c.wind_speed_10m)} km/h</span></div>
      <div class="cmp-row"><span>${t('precip')}</span><span>${c.precipitation}mm</span></div>
      <div class="cmp-row"><span>${LANG==='ko'?'ìµœê³ ':'Max'}</span><span>${Math.round(w.daily.temperature_2m_max[0])}Â°C</span></div>
      <div class="cmp-row"><span>${LANG==='ko'?'ìµœì €':'Min'}</span><span>${Math.round(w.daily.temperature_2m_min[0])}Â°C</span></div>`;
  }catch(ex){
    document.getElementById('cmpCard'+idx).innerHTML=`<p style="color:var(--danger);font-size:.8rem">ë°ì´í„° ë¡œë”© ì‹¤íŒ¨</p>`;
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ë‚ ì”¨ API
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function isKorea(la,lo){return la>=33&&la<=38.5&&lo>=124&&lo<=132}
function isJapan(la,lo){return la>=24&&la<=46&&lo>=122&&lo<=146&&!isKorea(la,lo)}

let lastWeatherData = null;

async function loadWeather(la,lo,n,e,f){
  let model;
  if(isKorea(la,lo)) model='kma_seamless';
  else if(isJapan(la,lo)) model='jma_seamless';
  else model='best_match';

  const ts = Date.now();
  const wURL = `https://api.open-meteo.com/v1/forecast?latitude=${la}&longitude=${lo}`
    +`&current=temperature_2m,relative_humidity_2m,apparent_temperature,weather_code,wind_speed_10m,wind_direction_10m,visibility,pressure_msl,uv_index,precipitation`
    +`&hourly=temperature_2m,weather_code,precipitation_probability`
    +`&daily=weather_code,temperature_2m_max,temperature_2m_min,sunrise,sunset`
    +`&timezone=auto&forecast_days=7&models=${model}&t=${ts}`;
  const aqURL = `https://air-quality-api.open-meteo.com/v1/air-quality?latitude=${la}&longitude=${lo}&current=pm10,pm2_5,nitrogen_dioxide&timezone=auto&t=${ts}`;

  try{
    const[wRes,aqRes]=await Promise.all([
      fetch(wURL,{cache:'no-store'}).catch(err=>{throw new Error('ë‚ ì”¨ API ì—°ê²° ì‹¤íŒ¨: '+err.message)}),
      fetch(aqURL,{cache:'no-store'}).catch(()=>null)
    ]);
    if(!wRes.ok) throw new Error(`ë‚ ì”¨ API ì˜¤ë¥˜ (HTTP ${wRes.status})`);
    const w=await wRes.json();
    const aq=aqRes&&aqRes.ok?await aqRes.json():null;
    if(w.error) throw new Error('API ì‘ë‹µ ì˜¤ë¥˜: '+(w.reason||''));
    // â”€â”€ 30ì¼ ìº˜ë¦°ë” ë°ì´í„° ë¡œë”© â”€â”€
    // ì „ëµ: 16ì¼ ì¼ë°˜ì˜ˆë³´(best_match) + ì•™ìƒë¸” 35ì¼(ecmwf_ifs04) ë³‘í•©
    // ì•™ìƒë¸” APIëŠ” KMA/JMA ë¯¸ì§€ì› â†’ í•­ìƒ ecmwf_ifs04 ê³ ì •
    let w30 = null;
    const mergedDaily = { time:[], weather_code:[], temperature_2m_max:[], temperature_2m_min:[], precipitation_probability_max:[] };
    const seen30 = new Set();

    const addToMerged = (date, code, hi, lo, pp) => {
      if(seen30.has(date)) return;
      seen30.add(date);
      mergedDaily.time.push(date);
      mergedDaily.weather_code.push(Math.round(code || 0));
      mergedDaily.temperature_2m_max.push(hi);
      mergedDaily.temperature_2m_min.push(lo);
      mergedDaily.precipitation_probability_max.push(pp ?? null);
    };

    try {
      // â‘  16ì¼ ì¼ë°˜ ì˜ˆë³´ (best_match: ì „ ì„¸ê³„ ì§€ì›, KMAë³´ë‹¤ ë²”ìœ„ ë„“ìŒ)
      const r16 = await fetch(
        `https://api.open-meteo.com/v1/forecast?latitude=${la}&longitude=${lo}` +
        `&daily=weather_code,temperature_2m_max,temperature_2m_min,precipitation_probability_max` +
        `&timezone=auto&forecast_days=16&models=best_match&t=${ts}`,
        {cache:'no-store'}
      );
      if(r16.ok) {
        const j16 = await r16.json();
        if(!j16.error && j16.daily) {
          j16.daily.time.forEach((date,i) => {
            addToMerged(date,
              j16.daily.weather_code[i],
              j16.daily.temperature_2m_max[i],
              j16.daily.temperature_2m_min[i],
              j16.daily.precipitation_probability_max?.[i]
            );
          });
        }
      }
    } catch(e16){ console.warn('16ì¼ ì˜ˆë³´ ì‹¤íŒ¨:', e16); }

    try {
      // â‘¡ ì•™ìƒë¸” 35ì¼ (ecmwf_ifs04 ê³ ì • - ì „ ì„¸ê³„ ì§€ì› ë³´ì¥)
      const rEns = await fetch(
        `https://ensemble-api.open-meteo.com/v1/ensemble?latitude=${la}&longitude=${lo}` +
        `&daily=temperature_2m_max,temperature_2m_min,weather_code,precipitation_probability_max` +
        `&timezone=auto&forecast_days=35&models=ecmwf_ifs04&t=${ts}`,
        {cache:'no-store'}
      );
      if(rEns.ok) {
        const jEns = await rEns.json();
        if(!jEns.error && jEns.daily) {
          // ì•™ìƒë¸”: ë©¤ë²„ë³„ ë°°ì—´ â†’ í‰ê· ê°’ìœ¼ë¡œ ìŠ¤ì¹¼ë¼ ë³€í™˜
          const avg = (v) => {
            if(v == null) return null;
            if(Array.isArray(v)) {
              const valid = v.filter(x => x != null && !isNaN(x));
              return valid.length ? valid.reduce((a,b)=>a+b,0)/valid.length : null;
            }
            return v;
          };
          jEns.daily.time.forEach((date,i) => {
            addToMerged(date,
              avg(jEns.daily.weather_code[i]),
              avg(jEns.daily.temperature_2m_max[i]),
              avg(jEns.daily.temperature_2m_min[i]),
              avg(jEns.daily.precipitation_probability_max?.[i])
            );
          });
        }
      }
    } catch(eEns){ console.warn('ì•™ìƒë¸” ì˜ˆë³´ ì‹¤íŒ¨:', eEns); }

    // ë³‘í•© ê²°ê³¼ê°€ ìˆìœ¼ë©´ w30ì— ì €ì¥, ì—†ìœ¼ë©´ ë©”ì¸ 7ì¼ ë°ì´í„° fallback
    if(mergedDaily.time.length > 0) {
      w30 = { daily: mergedDaily };
    } else if(w.daily) {
      // ì™„ì „ fallback: ë©”ì¸ 7ì¼ ë°ì´í„°ë¼ë„ ìº˜ë¦°ë”ì— í‘œì‹œ
      w30 = { daily: {
        time: w.daily.time,
        weather_code: w.daily.weather_code,
        temperature_2m_max: w.daily.temperature_2m_max,
        temperature_2m_min: w.daily.temperature_2m_min,
        precipitation_probability_max: new Array(w.daily.time.length).fill(null)
      }};
    }
    console.log('30ì¼ ìº˜ë¦°ë” ë°ì´í„° ë‚ ì§œ ìˆ˜:', w30?.daily?.time?.length || 0);

    lastWeatherData={w,aq,n,e,f,model,w30};
    render(w,aq,n,e,f,model,w30);
  }catch(ex){
    setErr(`<strong>${ex.message}</strong><br><br>ì¸í„°ë„· ì—°ê²°ì„ í™•ì¸í•˜ê±°ë‚˜ ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.`);
  }
}

function setLoading(city){
  document.getElementById('content').innerHTML=`<div class="state-msg"><div class="spinner"></div><div>${city} ${t('loading')}</div></div>`;
}
function setErr(msg){
  document.getElementById('content').innerHTML=`<div class="err-box"><div class="err-title">âš ï¸ ì˜¤ë¥˜</div>${msg}</div><div class="tip-box"><strong>í•´ê²° ë°©ë²•:</strong><br>ì¸í„°ë„· ì—°ê²° í™•ì¸ â†’ open-meteo.com ì§ì ‘ ì ‘ì† í…ŒìŠ¤íŠ¸</div>`;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// AQI ê³„ì‚°
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function calcAQI(pm25){
  if(pm25==null) return null;
  const levels = t('aqiLevels');
  if(pm25<=12) return{v:Math.round(pm25*4.2),l:levels.good,lk:'good',col:'#34d399'};
  if(pm25<=35.4) return{v:Math.round(50+(pm25-12)/23.4*50),l:levels.moderate,lk:'moderate',col:'#fbbf24'};
  if(pm25<=55.4) return{v:Math.round(100+(pm25-35.4)/20*50),l:levels.bad,lk:'bad',col:'#f97316'};
  return{v:Math.round(150+(pm25-55.4)/100*100),l:levels.vbad,lk:'vbad',col:'#f87171'};
}

function fmtTime(ts){if(!ts)return'--';return new Date(ts).toLocaleTimeString('ko-KR',{hour:'2-digit',minute:'2-digit'})}

// ì„­ì”¨ â†” í™”ì”¨ í† ê¸€
let useFahrenheit = false;
function toF(c){return Math.round(c*9/5+32)}
function dispTemp(c){return useFahrenheit?toF(c):Math.round(c)}
function dispUnit(){return useFahrenheit?'Â°F':'Â°C'}
function toggleUnit(){
  useFahrenheit=!useFahrenheit;
  if(lastWeatherData) render(lastWeatherData.w,lastWeatherData.aq,lastWeatherData.n,lastWeatherData.e,lastWeatherData.f,lastWeatherData.model);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ë Œë”ë§
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function render(w,aq,n,e,f,model,w30){
  const c=w.current, h=w.hourly, d=w.daily, now=new Date();
  const ico=ICO[c.weather_code]||'ğŸŒ¡ï¸';
  const dsc=(LANG==='ko'?WMO_KO:WMO_EN)[c.weather_code]||'';

  // ë‚ ì”¨ ë°°ê²½ ì ìš©
  applyWeatherTheme(c.weather_code);

  // ëª¨ë¸ëª…
  const mlabel = (t('modelLabel')[model]||'ğŸŒ Auto');

  // ë‚ ì§œ í¬ë§·
  const dateStr = now.toLocaleDateString(LANG==='ko'?'ko-KR':'en-US',{year:'numeric',month:'long',day:'numeric',weekday:'long'});

  // ì‹œê°„ë³„ (24h)
  const hourHTML=[];
  for(let i=0;i<h.time.length&&hourHTML.length<24;i++){
    const hd=new Date(h.time[i]);
    if(hd>=now-3600000){
      const isNow=Math.abs(hd-now)<3600000;
      const pp=h.precipitation_probability?.[i]||0;
      hourHTML.push(`<div class="hour-item${isNow?' now':''}">
        <span class="hour-time">${hd.getHours().toString().padStart(2,'0')}${LANG==='ko'?'ì‹œ':'h'}</span>
        <span class="hour-icon">${ICO[h.weather_code[i]]||'ğŸŒ¡ï¸'}</span>
        <span class="hour-temp">${dispTemp(h.temperature_2m[i])}Â°</span>
        ${pp>0?`<span class="hour-precip">${pp}%</span>`:''}
      </div>`);
    }
  }

  // ê°•ìˆ˜ ì°¨íŠ¸ ë°ì´í„° (48h)
  const chartTimes=[], chartProbs=[], chartTemps=[];
  for(let i=0;i<h.time.length&&chartTimes.length<48;i++){
    const hd=new Date(h.time[i]);
    if(hd>=now-3600000){
      chartTimes.push(h.time[i]);
      chartProbs.push(h.precipitation_probability?.[i]||0);
      chartTemps.push(h.temperature_2m[i]);
    }
  }

  // 7ì¼
  const allT=[...d.temperature_2m_max,...d.temperature_2m_min];
  const mn=Math.min(...allT),mx=Math.max(...allT),rng=mx-mn||1;
  const dayNames=t('days');
  const dayHTML=d.time.slice(0,7).map((t2,i)=>{
    const lo=d.temperature_2m_min[i],hi2=d.temperature_2m_max[i];
    const bl=((lo-mn)/rng*100).toFixed(1), bw=((hi2-lo)/rng*100).toFixed(1);
    const lb=i===0?t('today'):i===1?t('tomorrow'):dayNames[new Date(t2).getDay()]+(LANG==='ko'?'ìš”ì¼':'');
    return`<div class="day-item">
      <span class="day-name">${lb} ${ICO[d.weather_code[i]]||''}</span>
      <div class="day-bar-wrap"><div class="day-bar" style="left:${bl}%;width:${bw}%"></div></div>
      <span class="day-lo">${dispTemp(lo)}Â°</span>
      <span class="day-hi">${dispTemp(hi2)}Â°</span>
    </div>`;
  }).join('');

  // AQI
  const pm25=aq?.current?.pm2_5??null;
  const pm10=aq?.current?.pm10??null;
  const no2=aq?.current?.nitrogen_dioxide??null;
  const aqi=calcAQI(pm25);

  // ë°”ëŒ
  const wdirs=['N','NE','E','SE','S','SW','W','NW'];
  const wd=wdirs[Math.round((c.wind_direction_10m||0)/45)%8];

  // ë¸Œë¦¬í•‘ & ì˜·ì°¨ë¦¼ ë°ì´í„° ê³„ì‚°
  const briefData = genBriefing(c, d, h, now);

  // ì˜·ì°¨ë¦¼
  const outfit=getOutfit(c.temperature_2m, c.weather_code, c.relative_humidity_2m, c.wind_speed_10m);

  document.getElementById('content').innerHTML=`
  <!-- ë©”ì¸ ì¹´ë“œ -->
  <div class="main-card">
    <div class="city-name">${f} ${n}</div>
    <div class="city-meta">${e} Â· ${dateStr} Â· <span style="color:var(--accent2);font-size:.68rem">${mlabel}</span></div>
    <div class="main-content">
      <div class="temp-display" onclick="toggleUnit()" title="${LANG==='ko'?'í´ë¦­í•˜ë©´ Â°F/Â°C ì „í™˜':'Click to toggle Â°F/Â°C'}">
        <div class="temp-big">${dispTemp(c.temperature_2m)}</div>
        <div class="temp-unit">${dispUnit()}</div>
      </div>
      <div class="weather-detail">
        <div class="weather-desc">${ico} ${dsc}</div>
        <div class="detail-grid">
          <div class="detail-item"><span class="detail-label">${t('feels')}</span><span class="detail-val">${dispTemp(c.apparent_temperature)}${dispUnit()}</span></div>
          <div class="detail-item"><span class="detail-label">${t('humidity')}</span><span class="detail-val">${c.relative_humidity_2m}%</span></div>
          <div class="detail-item"><span class="detail-label">${t('uv')}</span><span class="detail-val">${c.uv_index??'--'}</span></div>
          <div class="detail-item"><span class="detail-label">${t('precip')}</span><span class="detail-val">${c.precipitation}mm</span></div>
        </div>
      </div>
    </div>
  </div>

  <!-- ë‚ ì”¨ ë¸Œë¦¬í•‘ -->
  <div class="brief-card">
    <div class="brief-icon">${briefData.icon}</div>
    <div class="brief-content">
      <div class="brief-label">${LANG==='ko'?'ğŸ“¢ ì˜¤ëŠ˜ì˜ ë‚ ì”¨ ë¸Œë¦¬í•‘':'ğŸ“¢ Today\'s Weather Brief'}</div>
      <div class="brief-text">${briefData.text}</div>
      <div class="brief-alerts">${briefData.alerts.map(a=>`<span class="brief-alert">${a}</span>`).join('')}</div>
    </div>
  </div>

  <!-- ì˜·ì°¨ë¦¼ ì¶”ì²œ -->
  <div class="outfit-card" style="--outfit-bg:${outfit.bg};--outfit-accent:${outfit.accent};--outfit-border:${outfit.border};--outfit-color:${outfit.color}">
    <div class="outfit-icon-wrap">${outfit.icon}</div>
    <div class="outfit-content">
      <div class="outfit-label">${t('outfit')}</div>
      <div class="outfit-title">${outfit.title}</div>
    </div>
    <div class="outfit-visual">
      <div class="outfit-big-emoji">${outfit.bigEmoji}</div>
      <div class="outfit-detail">
        <div class="outfit-temp-badge">${outfit.tempLabel}</div>
        <div class="outfit-items-row">
          ${outfit.pills.map(p=>`<div class="outfit-pill"><span class="outfit-pill-emoji">${p.e}</span>${p.n}</div>`).join('')}
        </div>
        <div class="outfit-tip">${outfit.tip}</div>
      </div>
    </div>
  </div>

  <!-- ì‹œê°„ë³„ ì˜ˆë³´ -->
  <div class="card" style="margin-bottom:20px">
    <div class="card-title">${t('hourly')}</div>
    <div class="hourly-scroll">${hourHTML.join('')}</div>
  </div>

  <!-- ê°•ìˆ˜ í™•ë¥  ì°¨íŠ¸ -->
  <div class="card" style="margin-bottom:20px">
    <div class="card-title">${t('precipChart')}</div>
    <div class="chart-wrap">
      <canvas class="chart-canvas" id="precipChart"></canvas>
    </div>
    <div class="chart-legend">
      <div class="chart-legend-item"><div class="legend-dot" style="background:rgba(79,156,249,0.7)"></div>${LANG==='ko'?'ê°•ìˆ˜ í™•ë¥  (ë§‰ëŒ€)':'Precip Probability (bars)'}</div>
      <div class="chart-legend-item"><div class="legend-dot" style="background:#fbbf24"></div>${LANG==='ko'?'ê¸°ì˜¨ (ì„ )':'Temperature (line)'}</div>
    </div>
  </div>

  <!-- 7ì¼ ì˜ˆë³´ + AQI -->
  <div class="grid-row grid-2">
    <div class="card">
      <div class="card-title">${t('weekly')}</div>
      <div class="day-list">${dayHTML}</div>
      <div class="week-chart-wrap" style="margin-top:16px">
        <canvas class="week-chart-canvas" id="weeklyChart"></canvas>
      </div>
    </div>
    <div class="card" style="padding:0;overflow:hidden">
      <div class="card-title" style="padding:14px 20px 10px;margin:0;border-bottom:1px solid var(--border)">${t('aqi')}</div>
      ${aqi?`
      <div class="aqi-display" style="--aqi-col:${aqi.col}">
        <!-- ìƒë‹¨: ì ìˆ˜ + ì„¤ëª… + ë°” -->
        <div class="aqi-hero">
          <div class="aqi-score-block" style="background:${aqi.col}1a;--aqi-glow:${aqi.col}44">
            <div class="aqi-num" style="color:${aqi.col};text-shadow:0 0 24px ${aqi.col}66">${aqi.v}</div>
            <div class="aqi-lbl">AQI</div>
            <div class="aqi-grade-badge" style="background:${aqi.col}">${aqi.l}</div>
          </div>
          <div class="aqi-right">
            <div class="aqi-right-desc">${t('aqiDesc')[aqi.lk]||''}</div>
            <div class="aqi-bar-wrap">
              <div class="aqi-bar-label"><span>PM2.5</span><span style="color:${aqi.col};font-weight:700">${pm25?.toFixed(1)??'--'} Î¼g/mÂ³</span></div>
              <div class="aqi-bar-track"><div class="aqi-bar-fill" style="width:${Math.min((pm25||0)/150*100,100)}%;background:${aqi.col}"></div></div>
              <div class="aqi-bar-label" style="margin-top:6px"><span>PM10</span><span style="font-weight:600">${pm10?.toFixed(1)??'--'} Î¼g/mÂ³</span></div>
              <div class="aqi-bar-track"><div class="aqi-bar-fill" style="width:${Math.min((pm10||0)/300*100,100)}%;background:#7dd3fc"></div></div>
              <div class="aqi-bar-label" style="margin-top:6px"><span>NOâ‚‚</span><span style="font-weight:600">${no2?.toFixed(1)??'--'} Î¼g/mÂ³</span></div>
              <div class="aqi-bar-track"><div class="aqi-bar-fill" style="width:${Math.min((no2||0)/200*100,100)}%;background:#a78bfa"></div></div>
            </div>
          </div>
        </div>
        <!-- ì¤‘ë‹¨: 4ë‹¨ê³„ ë ˆë²¨ ìŠ¤íŠ¸ë¦½ -->
        <div class="aqi-level-strip">
          <div class="aqi-level-cell ${aqi.lk==='good'?'active':''}" style="color:#34d399;background:${aqi.lk==='good'?'#34d39915':'transparent'}">
            <div class="aqi-level-dot" style="background:#34d399"></div>
            <div class="aqi-level-name">${LANG==='ko'?'ì¢‹ìŒ':'Good'}</div>
            <div class="aqi-level-range">0â€“50</div>
          </div>
          <div class="aqi-level-cell ${aqi.lk==='moderate'?'active':''}" style="color:#fbbf24;background:${aqi.lk==='moderate'?'#fbbf2415':'transparent'}">
            <div class="aqi-level-dot" style="background:#fbbf24"></div>
            <div class="aqi-level-name">${LANG==='ko'?'ë³´í†µ':'Moderate'}</div>
            <div class="aqi-level-range">51â€“100</div>
          </div>
          <div class="aqi-level-cell ${aqi.lk==='bad'?'active':''}" style="color:#f97316;background:${aqi.lk==='bad'?'#f9731615':'transparent'}">
            <div class="aqi-level-dot" style="background:#f97316"></div>
            <div class="aqi-level-name">${LANG==='ko'?'ë‚˜ì¨':'Unhealthy'}</div>
            <div class="aqi-level-range">101â€“150</div>
          </div>
          <div class="aqi-level-cell ${aqi.lk==='vbad'?'active':''}" style="color:#f87171;background:${aqi.lk==='vbad'?'#f8717115':'transparent'}">
            <div class="aqi-level-dot" style="background:#f87171"></div>
            <div class="aqi-level-name">${LANG==='ko'?'ë§¤ìš°ë‚˜ì¨':'Very Bad'}</div>
            <div class="aqi-level-range">151+</div>
          </div>
        </div>

        <!-- í•˜ë‹¨: ê±´ê°• ê°€ì´ë“œ + ë¯¼ê°êµ° -->
        <div class="aqi-health-wrap" style="border-top:1px solid var(--border)">

          <!-- ê±´ê°• í–‰ë™ ì¹´ë“œ -->
          <div class="aqi-action-row">
            ${(()=>{
              const actions = {
                good: [
                  {icon:'ğŸƒ',ko:'ì•¼ì™¸ ìš´ë™ ìµœì ',en:'Perfect for outdoor exercise'},
                  {icon:'ğŸªŸ',ko:'í™˜ê¸° ì¶”ì²œ',en:'Open windows freely'},
                  {icon:'ğŸ˜Š',ko:'ë§ˆìŠ¤í¬ ë¶ˆí•„ìš”',en:'No mask needed'},
                ],
                moderate: [
                  {icon:'ğŸš¶',ko:'ê°€ë²¼ìš´ í™œë™ ê¶Œì¥',en:'Light activity OK'},
                  {icon:'ğŸ˜·',ko:'ë¯¼ê°êµ° ë§ˆìŠ¤í¬ ì°©ìš©',en:'Mask for sensitive groups'},
                  {icon:'ğŸ ',ko:'ì¥ì‹œê°„ ì™¸ì¶œ ì£¼ì˜',en:'Limit long outdoor stays'},
                ],
                bad: [
                  {icon:'ğŸ˜·',ko:'ë§ˆìŠ¤í¬ í•„ìˆ˜',en:'Mask required'},
                  {icon:'ğŸ ',ko:'ì‹¤ë‚´ í™œë™ ê¶Œì¥',en:'Stay indoors'},
                  {icon:'ğŸš«',ko:'ê²©ë ¬í•œ ìš´ë™ ê¸ˆì§€',en:'Avoid strenuous exercise'},
                ],
                vbad: [
                  {icon:'ğŸš¨',ko:'ì™¸ì¶œ ìì œ',en:'Avoid going out'},
                  {icon:'ğŸ˜·',ko:'KF94 ë§ˆìŠ¤í¬ ì°©ìš©',en:'Wear KF94 mask'},
                  {icon:'ğŸ¥',ko:'í˜¸í¡ê¸° ì¦ìƒ ì£¼ì˜',en:'Watch for symptoms'},
                ],
              };
              return (actions[aqi.lk]||actions.good).map(a=>`
                <div class="aqi-action-item">
                  <div class="aqi-action-icon">${a.icon}</div>
                  <div class="aqi-action-text">${LANG==='ko'?a.ko:a.en}</div>
                </div>`).join('');
            })()}
          </div>

          <!-- ë¯¼ê°êµ° ì˜í–¥ -->
          <div class="aqi-sensitive-row">
            <div class="aqi-sensitive-title">${LANG==='ko'?'ğŸ‘¥ ë¯¼ê°êµ° ì˜í–¥':'ğŸ‘¥ Sensitive Groups'}</div>
            <div class="aqi-sensitive-items">
              ${(()=>{
                const lvl = {good:0,moderate:1,bad:2,vbad:3}[aqi.lk]||0;
                const groups = [
                  {icon:'ğŸ‘¶',ko:'ì˜ìœ ì•„',en:'Infants',threshold:0},
                  {icon:'ğŸ¤§',ko:'í˜¸í¡ê¸° ì§ˆí™˜',en:'Respiratory',threshold:0},
                  {icon:'â¤ï¸',ko:'ì‹¬í˜ˆê´€ ì§ˆí™˜',en:'Heart Disease',threshold:0},
                  {icon:'ğŸ§“',ko:'ê³ ë ¹ì',en:'Elderly',threshold:1},
                  {icon:'ğŸƒ',ko:'ìš´ë™ì„ ìˆ˜',en:'Athletes',threshold:1},
                  {icon:'ğŸ§‘',ko:'ì¼ë°˜ì¸',en:'General',threshold:2},
                ];
                return groups.map(g=>{
                  const affected = lvl >= g.threshold;
                  return `<div class="aqi-sensitive-item ${affected?'affected':''}">
                    <span>${g.icon}</span>
                    <span>${LANG==='ko'?g.ko:g.en}</span>
                  </div>`;
                }).join('');
              })()}
            </div>
          </div>

        </div>

      </div>`:`<p style="color:var(--muted);font-size:.82rem;padding:20px">${LANG==='ko'?'ëŒ€ê¸°ì§ˆ ë°ì´í„° ì—†ìŒ':'No AQI data'}</p>`}
    </div>
  </div>

  <!-- ì¼ì¶œ/ì¼ëª° + ë°”ëŒ + ê¸°ì•• -->
  <!-- 30ì¼ ìº˜ë¦°ë” ì»¨í…Œì´ë„ˆ -->
  <div id="calContainer"></div>

  <div class="grid-row grid-3">
    <div class="card">
      <div class="card-title">${t('sunrise')} Â· ${t('sunset')}</div>
      <div class="sun-arc-wrap">
        <svg class="sun-arc-svg" id="sunArcSvg" viewBox="0 0 220 120">
          <defs>
            <linearGradient id="horizGrad" x1="0" y1="0" x2="1" y2="0">
              <stop offset="0%" stop-color="#1e3a5f" stop-opacity="0.8"/>
              <stop offset="50%" stop-color="#f59e0b" stop-opacity="0.25"/>
              <stop offset="100%" stop-color="#1e3a5f" stop-opacity="0.8"/>
            </linearGradient>
            <radialGradient id="sunGlow" cx="50%" cy="50%" r="50%">
              <stop offset="0%" stop-color="#fde68a" stop-opacity="1"/>
              <stop offset="60%" stop-color="#fbbf24" stop-opacity="0.8"/>
              <stop offset="100%" stop-color="#f59e0b" stop-opacity="0"/>
            </radialGradient>
          </defs>
          <!-- ì§€í‰ì„  -->
          <line x1="10" y1="100" x2="210" y2="100" stroke="rgba(255,255,255,0.08)" stroke-width="1"/>
          <!-- ë°°ê²½ í˜¸ (ë°˜ì›) -->
          <path d="M15,100 A95,95 0 0,1 205,100"
            fill="none" stroke="rgba(255,255,255,0.05)" stroke-width="14" stroke-linecap="round"/>
          <!-- ì§„í–‰ í˜¸ -->
          <path id="sunProgressArc" d="M15,100 A95,95 0 0,1 205,100"
            fill="none" stroke="rgba(251,191,36,0.55)" stroke-width="3"
            stroke-linecap="round"
            stroke-dasharray="299" stroke-dashoffset="299"
            style="transition:stroke-dashoffset 1.2s ease"/>
          <!-- íƒœì–‘ ê¸€ë¡œìš° -->
          <circle id="sunGlowCircle" cx="110" cy="5" r="18"
            fill="url(#sunGlow)" opacity="0" style="transition:all 1.2s ease"/>
          <!-- íƒœì–‘ ë³¸ì²´ -->
          <circle id="sunDotArc" cx="110" cy="5" r="7"
            fill="#fbbf24" opacity="0" style="transition:all 1.2s ease">
            <animate attributeName="r" values="7;8.5;7" dur="3s" repeatCount="indefinite"/>
          </circle>
          <!-- ì¼ì¶œ ë¼ë²¨ -->
          <text x="15" y="116" font-size="9" fill="rgba(251,191,36,0.7)" font-family="DM Mono, monospace">ğŸŒ… ${fmtTime(d.sunrise?.[0])}</text>
          <!-- ì¼ëª° ë¼ë²¨ -->
          <text x="205" y="116" font-size="9" fill="rgba(251,191,36,0.7)" font-family="DM Mono, monospace" text-anchor="end">ğŸŒ‡ ${fmtTime(d.sunset?.[0])}</text>
          <!-- í˜„ì¬ ì‹œê° ë¼ë²¨ -->
          <text id="sunTimeLabel" x="110" y="80" font-size="9"
            fill="rgba(255,255,255,0.5)" font-family="DM Mono, monospace" text-anchor="middle"/>
        </svg>
      </div>
    </div>
    <div class="card">
      <div class="card-title">${t('wind')}</div>
      <div class="wind-compass"><div class="wind-arrow" style="transform:rotate(${c.wind_direction_10m||0}deg)"></div></div>
      <div class="wind-stats">
        <div class="wind-speed">${Math.round(c.wind_speed_10m)}<span class="wind-unit"> km/h</span></div>
        <div style="font-size:.72rem;color:var(--muted);margin-top:3px">${t('windDir')}: ${wd} (${c.wind_direction_10m||0}Â°)</div>
      </div>
    </div>
    <div class="card">
      <div class="card-title">${t('pressure')} Â· ${t('visibility')}</div>
      <div class="big-stat">
        <div class="val">${Math.round(c.pressure_msl)}</div>
        <div class="unit-lbl">${t('hPa')}</div>
        <div style="margin-top:10px;border-top:1px solid var(--border);padding-top:10px;width:100%;text-align:center">
          <div class="val" style="font-size:1.7rem">${c.visibility?(c.visibility/1000).toFixed(1):'--'}</div>
          <div class="unit-lbl">${t('km')}</div>
        </div>
      </div>
    </div>
  </div>`;

  // ì°¨íŠ¸ ê·¸ë¦¬ê¸° (DOM ì—…ë°ì´íŠ¸ í›„)
  requestAnimationFrame(()=>{
    drawPrecipChart('precipChart', chartTimes, chartProbs, chartTemps);
    drawSunArc(d.sunrise?.[0], d.sunset?.[0], now);
    drawWeeklyChart('weeklyChart', d);
  });

  // 30ì¼ ìº˜ë¦°ë” ì‚½ì… (render ì§í›„)
  renderCalendar(w, w30);
}


// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// 30ì¼ ìº˜ë¦°ë”
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let calOffset = 0; // 0=ì´ë²ˆë‹¬, 1=ë‹¤ìŒë‹¬
let calData16 = null;
let calData30 = null;

function renderCalendar(w16, w30) {
  calData30 = w30;  // w30ì— ì´ë¯¸ 16ì¼+ì•™ìƒë¸” ë³‘í•© ì™„ë£Œ
  calOffset = 0;
  buildCalendar();
}

function calNav(dir) {
  calOffset += dir;
  buildCalendar();
}

function buildCalendar() {
  const container = document.getElementById('calContainer');
  if (!container) return;

  // í†µí•© ë°ì´í„°(w30)ì—ì„œ ë‚ ì§œë³„ allDays êµ¬ì„±
  const allDays = {};
  if (calData30 && calData30.daily) {
    const d = calData30.daily;
    d.time.forEach((date, i) => {
      const src = i < 16 ? '16d' : '30d';
      allDays[date] = {
        hi: d.temperature_2m_max[i],
        lo: d.temperature_2m_min[i],
        code: Math.round(d.weather_code[i] || 0),
        pp: d.precipitation_probability_max?.[i] ?? null,
        src
      };
    });
  }

  const now = new Date();
  const targetDate = new Date(now.getFullYear(), now.getMonth() + calOffset, 1);
  const year = targetDate.getFullYear();
  const month = targetDate.getMonth();
  const monthNames = LANG === 'ko'
    ? ['1ì›”','2ì›”','3ì›”','4ì›”','5ì›”','6ì›”','7ì›”','8ì›”','9ì›”','10ì›”','11ì›”','12ì›”']
    : ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];
  const dowLabels = LANG === 'ko'
    ? ['ì¼','ì›”','í™”','ìˆ˜','ëª©','ê¸ˆ','í† ']
    : ['Sun','Mon','Tue','Wed','Thu','Fri','Sat'];

  const firstDow = new Date(year, month, 1).getDay();
  const daysInMonth = new Date(year, month + 1, 0).getDate();

  const todayStr = `${now.getFullYear()}-${String(now.getMonth()+1).padStart(2,'0')}-${String(now.getDate()).padStart(2,'0')}`;

  // ì´ì „ ë‹¬ ë¹„í™œì„±í™” ì—¬ë¶€
  const prevDisabled = calOffset <= 0;
  // ë‹¤ìŒ ë‹¬: ìµœëŒ€ 1ê°œì›” ì•
  const nextDisabled = calOffset >= 1;

  let html = `
  <div class="cal-card">
    <div class="cal-header">
      <div class="cal-title">ğŸ“… ${LANG==='ko'?'30ì¼ ë‚ ì”¨ ìº˜ë¦°ë”':'30-Day Weather Calendar'}</div>
      <div class="cal-month-nav">
        <button class="cal-nav-btn" onclick="calNav(-1)" ${prevDisabled?'disabled':''}>â—€</button>
        <div class="cal-month-label">${year}${LANG==='ko'?'ë…„ ':' '}${monthNames[month]}</div>
        <button class="cal-nav-btn" onclick="calNav(1)" ${nextDisabled?'disabled':''}>â–¶</button>
      </div>
    </div>
    <div class="cal-grid">`;

  // ìš”ì¼ í—¤ë”
  dowLabels.forEach(d => { html += `<div class="cal-dow">${d}</div>`; });

  // ë¹ˆ ì¹¸ (ì²«ì§¸ ë‚  ìš”ì¼ ë§ì¶”ê¸°)
  for (let i = 0; i < firstDow; i++) {
    html += `<div class="cal-cell cal-empty"></div>`;
  }

  // ë‚ ì§œ ì…€
  for (let day = 1; day <= daysInMonth; day++) {
    const dateStr = `${year}-${String(month+1).padStart(2,'0')}-${String(day).padStart(2,'0')}`;
    const dayData = allDays[dateStr];
    const isToday = dateStr === todayStr;
    const isPast = dateStr < todayStr;
    const isFuture16 = dayData && dayData.src === '30d';

    let cls = 'cal-cell';
    if (isToday) cls += ' cal-today';
    else if (isPast) cls += ' cal-past';
    else if (isFuture16) cls += ' cal-future-fade';

    const dow = new Date(year, month, day).getDay();
    const numColor = dow === 0 ? 'color:#f87171' : dow === 6 ? 'color:#818cf8' : '';

    if (dayData && dayData.hi != null) {
      const ico = ICO[dayData.code] || 'ğŸŒ¡ï¸';
      const pp = dayData.pp;
      const ppBar = pp != null ? `<div class="cal-precip-bar"><div class="cal-precip-fill" style="width:${pp}%"></div></div>` : '';
      const ppLabel = pp != null && pp > 0 ? `<span class="cal-pp">${pp}%</span>` : '';
      const hiDisplay = dispTemp(dayData.hi);
      const loDisplay = dispTemp(dayData.lo);

      html += `<div class="${cls}">
        <div class="cal-day-num" style="${numColor}">${day}</div>
        <div class="cal-ico">${ico}</div>
        <div class="cal-hi">${hiDisplay}Â°</div>
        <div class="cal-lo">${loDisplay}Â°</div>
        ${ppBar}
        ${ppLabel}
      </div>`;
    } else {
      html += `<div class="${cls} cal-empty" style="background:var(--surface2);border-color:var(--border);opacity:.2">
        <div class="cal-day-num" style="${numColor}">${day}</div>
      </div>`;
    }
  }

  html += `</div>
    <div class="cal-legend">
      <div class="cal-legend-item"><div class="cal-legend-dot" style="background:var(--accent)"></div>${LANG==='ko'?'ì˜¤ëŠ˜':'Today'}</div>
      <div class="cal-legend-item"><div class="cal-legend-dot" style="background:rgba(79,156,249,.4)"></div>${LANG==='ko'?'íŒŒë€ ë°” = ê°•ìˆ˜ í™•ë¥ ':'Blue bar = Precip probability'}</div>
      <div class="cal-legend-item"><div class="cal-legend-dot" style="background:rgba(255,255,255,.2)"></div>${LANG==='ko'?'íë¦° ì…€ = ì•™ìƒë¸” ì˜ˆì¸¡ (ë¶ˆí™•ì‹¤ì„± ë†’ìŒ)':'Faded = Ensemble forecast (less certain)'}</div>
    </div>
  </div>`;

  container.innerHTML = html;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ë‚ ì”¨ ë¸Œë¦¬í•‘ ìƒì„±
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function genBriefing(c, d, h, now) {
  const isKo = LANG === 'ko';
  const temp  = Math.round(c.temperature_2m);
  const feels = Math.round(c.apparent_temperature);
  const code  = c.weather_code;
  const desc  = (isKo ? WMO_KO : WMO_EN)[code] || '';
  const hiDay = Math.round(d.temperature_2m_max[0]);
  const loDay = Math.round(d.temperature_2m_min[0]);

  // ì˜¤ëŠ˜ ì˜¤í›„(12~20ì‹œ) ìµœëŒ€ ê°•ìˆ˜ í™•ë¥  íƒìƒ‰
  let pmRainPct = 0;
  (h.time || []).forEach((ts, i) => {
    const hd = new Date(ts);
    if (hd.toDateString() === now.toDateString() && hd.getHours() >= 12 && hd.getHours() <= 20) {
      const pp = h.precipitation_probability?.[i] || 0;
      if (pp > pmRainPct) pmRainPct = pp;
    }
  });

  // ì•Œë¦¼ íƒœê·¸ ìƒì„±
  const alerts = [];
  if (pmRainPct >= 50) alerts.push(isKo ? `ğŸŒ‚ ì˜¤í›„ ê°•ìˆ˜ ${pmRainPct}%` : `ğŸŒ‚ PM Rain ${pmRainPct}%`);
  if ((c.uv_index || 0) >= 7)         alerts.push(isKo ? 'ğŸ•¶ï¸ ìì™¸ì„  ê°•í•¨' : 'ğŸ•¶ï¸ High UV');
  if (c.wind_speed_10m >= 40)          alerts.push(isKo ? 'ğŸ’¨ ê°•í’ ì£¼ì˜'   : 'ğŸ’¨ Strong Wind');
  if (c.relative_humidity_2m >= 82)    alerts.push(isKo ? 'ğŸ’§ ê³ ìŠµë„'      : 'ğŸ’§ High Humidity');
  if (temp <= 0)                        alerts.push(isKo ? 'ğŸ§Š ê²°ë¹™ ì£¼ì˜'   : 'ğŸ§Š Ice Risk');
  if (temp >= 33)                       alerts.push(isKo ? 'ğŸ”¥ í­ì—¼ ì£¼ì˜'   : 'ğŸ”¥ Heat Warning');
  if (!alerts.length)                   alerts.push(isKo ? 'âœ… íŠ¹ë³„ ì£¼ì˜ì‚¬í•­ ì—†ìŒ' : 'âœ… No major alerts');

  // ì•„ì´ì½˜ ì„ íƒ
  let icon = 'â›…';
  if (code >= 95)                icon = 'â›ˆï¸';
  else if (code >= 80)           icon = 'ğŸŒ§ï¸';
  else if (code >= 71)           icon = 'â„ï¸';
  else if (code >= 61)           icon = 'ğŸŒ§ï¸';
  else if (code >= 51)           icon = 'ğŸŒ¦ï¸';
  else if (code <= 1)            icon = temp >= 28 ? 'â˜€ï¸' : 'ğŸŒ¤ï¸';

  // ë³¸ë¬¸ í…ìŠ¤íŠ¸
  const rangeStr = isKo
    ? `<br><span style="display:inline-flex;flex-wrap:wrap;gap:10px 16px;margin-top:6px;align-items:center"><span style="font-size:1rem;font-weight:800;color:#ff8800;letter-spacing:.02em;white-space:nowrap">ğŸŒ¡ï¸ ìµœê³  <span style="font-size:1.2rem">${dispTemp(d.temperature_2m_max[0])}Â°</span></span><span style="color:var(--muted);font-size:1rem">|</span><span style="font-size:1rem;font-weight:800;color:#4fc3f7;letter-spacing:.02em;white-space:nowrap">â„ï¸ ìµœì € <span style="font-size:1.2rem">${dispTemp(d.temperature_2m_min[0])}Â°</span></span></span>`
    : `<br><span style="display:inline-flex;flex-wrap:wrap;gap:10px 16px;margin-top:6px;align-items:center"><span style="font-size:1rem;font-weight:800;color:#ff8800;white-space:nowrap">ğŸŒ¡ï¸ High <span style="font-size:1.2rem">${dispTemp(d.temperature_2m_max[0])}Â°</span></span><span style="color:var(--muted);font-size:1rem">|</span><span style="font-size:1rem;font-weight:800;color:#4fc3f7;white-space:nowrap">â„ï¸ Low <span style="font-size:1.2rem">${dispTemp(d.temperature_2m_min[0])}Â°</span></span></span>`;
  const rainNote = pmRainPct >= 50
    ? (isKo ? ' ì˜¤í›„ì— ë¹„ê°€ ì˜¬ ìˆ˜ ìˆìœ¼ë‹ˆ ìš°ì‚°ì„ ì±™ê¸°ì„¸ìš”.' : ' Chance of afternoon rain â€” bring an umbrella.')
    : '';
  const uvNote = (c.uv_index || 0) >= 7
    ? (isKo ? ' ìì™¸ì„ ì´ ê°•í•˜ë‹ˆ ì„ í¬ë¦¼ì„ ì±™ê¸°ì„¸ìš”.' : ' Strong UV â€” apply sunscreen.') : '';

  let text;
  if (code >= 95)
    text = isKo
      ? `ë‡Œìš° ì˜ˆë³´ì…ë‹ˆë‹¤. í˜„ì¬ ${temp}${dispUnit()} (ì²´ê° ${feels}${dispUnit()}), ${rangeStr}. ì™¸ì¶œ ì‹œ ê°ë³„íˆ ì£¼ì˜í•˜ì„¸ìš”.`
      : `Thunderstorm expected. Currently ${temp}${dispUnit()} (feels ${feels}${dispUnit()}), ${rangeStr}. Take care if going out.`;
  else if (code >= 61 || code === 80 || code === 81 || code === 82)
    text = isKo
      ? `${desc} ì˜ˆë³´ì…ë‹ˆë‹¤. í˜„ì¬ ${temp}${dispUnit()} (ì²´ê° ${feels}${dispUnit()}), ${rangeStr}.${rainNote}`
      : `${desc} expected. Currently ${temp}${dispUnit()} (feels ${feels}${dispUnit()}), ${rangeStr}.${rainNote}`;
  else if (code >= 71 && code <= 77)
    text = isKo
      ? `ëˆˆ ì˜ˆë³´ì…ë‹ˆë‹¤. í˜„ì¬ ${temp}${dispUnit()} (ì²´ê° ${feels}${dispUnit()}), ${rangeStr}. ë„ë¡œ ê²°ë¹™ì— ì£¼ì˜í•˜ì„¸ìš”.`
      : `Snow expected. ${temp}${dispUnit()} (feels ${feels}${dispUnit()}), ${rangeStr}. Watch for icy roads.`;
  else if (code <= 1)
    text = isKo
      ? `ë§‘ì€ ë‚ ì”¨ì…ë‹ˆë‹¤. í˜„ì¬ ${temp}${dispUnit()} (ì²´ê° ${feels}${dispUnit()}), ${rangeStr}.${rainNote}${uvNote}`
      : `Clear skies. Currently ${temp}${dispUnit()} (feels ${feels}${dispUnit()}), ${rangeStr}.${rainNote}${uvNote}`;
  else
    text = isKo
      ? `${desc} ë‚ ì”¨ì…ë‹ˆë‹¤. í˜„ì¬ ${temp}${dispUnit()} (ì²´ê° ${feels}${dispUnit()}), ${rangeStr}.${rainNote}`
      : `${desc}. Currently ${temp}${dispUnit()} (feels ${feels}${dispUnit()}), ${rangeStr}.${rainNote}`;

  return { icon, text, alerts };
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ì¼ì¶œ/ì¼ëª° ì•„í¬ ì‹œê°í™”
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function drawSunArc(sunriseStr, sunsetStr, now) {
  const dot      = document.getElementById('sunDotArc');
  const glow     = document.getElementById('sunGlowCircle');
  const arc      = document.getElementById('sunProgressArc');
  const timeLabel= document.getElementById('sunTimeLabel');
  if (!dot || !arc) return;

  if (!sunriseStr || !sunsetStr) {
    dot.setAttribute('opacity','0');
    if (glow) glow.setAttribute('opacity','0');
    return;
  }

  const sunrise = new Date(sunriseStr);
  const sunset  = new Date(sunsetStr);
  const total   = sunset - sunrise;
  const elapsed = now  - sunrise;
  const ratio   = Math.max(0, Math.min(1, elapsed / total));
  const isDay   = now >= sunrise && now <= sunset;

  // ë°˜ì› ìœ„ ì¢Œí‘œ ê³„ì‚°: ì¤‘ì‹¬(110,100), ë°˜ì§€ë¦„ 95
  // ratio=0 â†’ ì™¼ìª½(15,100), ratio=1 â†’ ì˜¤ë¥¸ìª½(205,100)
  const angle = Math.PI * (1 - ratio);   // Ï€ â†’ 0
  const cx = 110 - 95 * Math.cos(Math.PI * ratio);
  const cy = 100 - 95 * Math.sin(Math.PI * ratio);

  dot.setAttribute('cx', cx.toFixed(1));
  dot.setAttribute('cy', cy.toFixed(1));
  dot.setAttribute('opacity', isDay ? '1' : '0.25');
  if (glow) {
    glow.setAttribute('cx', cx.toFixed(1));
    glow.setAttribute('cy', cy.toFixed(1));
    glow.setAttribute('opacity', isDay ? '0.6' : '0');
  }

  // ì§„í–‰ ì•„í¬: ë°˜ì› ë‘˜ë ˆ = Ï€ Ã— 95 â‰ˆ 299
  const arcLen = Math.PI * 95;
  arc.setAttribute('stroke-dashoffset', (arcLen * (1 - ratio)).toFixed(1));

  // í˜„ì¬ ì‹œê° í‘œì‹œ
  if (timeLabel) {
    const nowStr = now.toLocaleTimeString(
      LANG === 'ko' ? 'ko-KR' : 'en-US',
      { hour: '2-digit', minute: '2-digit' }
    );
    const lx = Math.max(30, Math.min(190, cx));
    const ly = Math.max(16, cy - 14);
    timeLabel.setAttribute('x', lx.toFixed(0));
    timeLabel.setAttribute('y', ly.toFixed(0));
    timeLabel.textContent = isDay ? nowStr : (LANG === 'ko' ? 'ì•¼ê°„' : 'Night');
    timeLabel.setAttribute('fill', isDay ? 'rgba(255,255,255,0.7)' : 'rgba(90,100,120,0.6)');
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// macOS Electron íƒ€ì´í‹€ë°” ì²˜ë¦¬
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•


// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// â­ ì¦ê²¨ì°¾ê¸°
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function getFavs(){ try{ return JSON.parse(localStorage.getItem('hwang_favs')||'[]'); }catch(e){ return []; } }
function setFavs(f){ localStorage.setItem('hwang_favs', JSON.stringify(f)); }

function renderFavBar(){
  const bar = document.getElementById('favBar');
  if(!bar) return;
  const favs = getFavs();
  if(!favs.length){ bar.innerHTML=''; return; }
  bar.innerHTML = favs.map((c,i)=>`
    <div class="fav-chip" onclick="pickFav(${i})">
      <span>${c.f}</span>
      <span>${c.n}</span>
      ${c.temp != null ? `<span class="fav-temp">${dispTemp(c.temp)}Â°</span>` : ''}
      <span class="fav-x" onclick="removeFav(event,${i})">âœ•</span>
    </div>`
  ).join('');
}

function addFav(){
  if(!lastWeatherData) return;
  const {n,e,f,w} = lastWeatherData;
  const favs = getFavs();
  if(favs.some(x=>x.n===n)){
    // ì´ë¯¸ ìˆìœ¼ë©´ ì œê±° (í† ê¸€)
    const idx = favs.findIndex(x=>x.n===n);
    favs.splice(idx,1);
    setFavs(favs); renderFavBar(); return;
  }
  const match = CITIES.find(x=>x.n===n||x.e===e);
  const temp = w?.current?.temperature_2m ?? null;
  favs.unshift({n, e, f,
    la: match?.la||0, lo: match?.lo||0, temp
  });
  if(favs.length > 8) favs.pop(); // ìµœëŒ€ 8ê°œ
  setFavs(favs); renderFavBar();
}

function removeFav(ev, idx){
  ev.stopPropagation();
  const favs = getFavs();
  favs.splice(idx,1);
  setFavs(favs); renderFavBar();
}

function pickFav(idx){
  const favs = getFavs();
  const c = favs[idx]; if(!c) return;
  const match = CITIES.find(x=>x.n===c.n||x.e===c.e);
  const la = match?.la || c.la;
  const lo = match?.lo || c.lo;
  inp.value = c.n;
  setLoading(c.n);
  loadWeather(la, lo, c.n, c.e, c.f);
}

// ì¦ê²¨ì°¾ê¸° ê¸°ì˜¨ ì—…ë°ì´íŠ¸ (ë„ì‹œ ë¡œë“œ í›„ í˜¸ì¶œ)
function updateFavTemp(n, temp){
  const favs = getFavs();
  const idx = favs.findIndex(x=>x.n===n);
  if(idx>=0){ favs[idx].temp=temp; setFavs(favs); renderFavBar(); }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ğŸ“ˆ ì£¼ê°„ ê¸°ì˜¨ ê·¸ë˜í”„ (7ì¼ ìµœê³ /ìµœì € ì„  ê·¸ë˜í”„)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function drawWeeklyChart(canvasId, daily){
  const canvas = document.getElementById(canvasId);
  if(!canvas) return;
  const ctx = canvas.getContext('2d');
  const W = canvas.offsetWidth;
  const H = canvas.offsetHeight;
  canvas.width  = W * window.devicePixelRatio;
  canvas.height = H * window.devicePixelRatio;
  ctx.scale(window.devicePixelRatio, window.devicePixelRatio);
  ctx.clearRect(0,0,W,H);

  const maxArr = daily.temperature_2m_max.slice(0,7).map(v=>dispTemp(v));
  const minArr = daily.temperature_2m_min.slice(0,7).map(v=>dispTemp(v));
  const days   = daily.time.slice(0,7);
  const n      = days.length;
  if(!n) return;

  const PAD = {top:20, right:20, bottom:28, left:36};
  const cW = W - PAD.left - PAD.right;
  const cH = H - PAD.top  - PAD.bottom;

  const allT   = [...maxArr, ...minArr];
  const minT   = Math.min(...allT);
  const maxT   = Math.max(...allT);
  const rangeT = maxT - minT || 1;

  const xPos = i => PAD.left + (i / (n-1)) * cW;
  const yPos = v => PAD.top  + cH - ((v - minT) / rangeT) * cH;

  // ê·¸ë¼ë°ì´ì…˜ ì˜ì—­ (ìµœê³ ~ìµœì € ì‚¬ì´ ì±„ìš°ê¸°)
  const grad = ctx.createLinearGradient(0, PAD.top, 0, PAD.top + cH);
  grad.addColorStop(0,   'rgba(251,191,36,0.15)');
  grad.addColorStop(0.5, 'rgba(79,156,249,0.08)');
  grad.addColorStop(1,   'rgba(129,140,248,0.15)');

  ctx.beginPath();
  maxArr.forEach((v,i) => i===0 ? ctx.moveTo(xPos(i),yPos(v)) : ctx.lineTo(xPos(i),yPos(v)));
  minArr.slice().reverse().forEach((v,i) => ctx.lineTo(xPos(n-1-i), yPos(v)));
  ctx.closePath();
  ctx.fillStyle = grad;
  ctx.fill();

  // ìµœê³  ê¸°ì˜¨ ì„ 
  ctx.beginPath();
  ctx.strokeStyle = '#fbbf24';
  ctx.lineWidth   = 2.5;
  ctx.lineJoin    = 'round';
  ctx.lineCap     = 'round';
  maxArr.forEach((v,i) => i===0 ? ctx.moveTo(xPos(i),yPos(v)) : ctx.lineTo(xPos(i),yPos(v)));
  ctx.stroke();

  // ìµœì € ê¸°ì˜¨ ì„ 
  ctx.beginPath();
  ctx.strokeStyle = '#818cf8';
  ctx.lineWidth   = 2;
  minArr.forEach((v,i) => i===0 ? ctx.moveTo(xPos(i),yPos(v)) : ctx.lineTo(xPos(i),yPos(v)));
  ctx.stroke();

  // ë°ì´í„° í¬ì¸íŠ¸ + ê°’ ë¼ë²¨
  const dayNames = LANG==='ko'
    ? ['ì¼','ì›”','í™”','ìˆ˜','ëª©','ê¸ˆ','í† ']
    : ['Su','Mo','Tu','We','Th','Fr','Sa'];

  days.forEach((t,i) => {
    const hiY = yPos(maxArr[i]);
    const loY = yPos(minArr[i]);
    const x   = xPos(i);

    // ìµœê³  ì 
    ctx.beginPath();
    ctx.arc(x, hiY, 4, 0, Math.PI*2);
    ctx.fillStyle = '#fbbf24';
    ctx.fill();

    // ìµœì € ì 
    ctx.beginPath();
    ctx.arc(x, loY, 3.5, 0, Math.PI*2);
    ctx.fillStyle = '#818cf8';
    ctx.fill();

    // ìµœê³  ê°’
    ctx.fillStyle = 'rgba(251,191,36,.9)';
    ctx.font = `bold 10px DM Mono, monospace`;
    ctx.textAlign = 'center';
    ctx.fillText(`${maxArr[i]}Â°`, x, hiY - 8);

    // ìµœì € ê°’
    ctx.fillStyle = 'rgba(129,140,248,.9)';
    ctx.font = `10px DM Mono, monospace`;
    ctx.fillText(`${minArr[i]}Â°`, x, loY + 14);

    // ìš”ì¼ Xì¶•
    const dow = new Date(t).getDay();
    ctx.fillStyle = i===0
      ? 'rgba(79,156,249,.9)'
      : dow===0 ? 'rgba(248,113,113,.8)'
      : 'rgba(90,100,120,.8)';
    ctx.font = `9px DM Mono, monospace`;
    ctx.fillText(
      i===0 ? (LANG==='ko'?'ì˜¤ëŠ˜':'Today') : dayNames[dow],
      x, H - PAD.bottom + 14
    );
  });

  // ë²”ë¡€
  ctx.textAlign = 'left';
  ctx.font = '9px DM Mono, monospace';

  ctx.fillStyle = '#fbbf24';
  ctx.fillRect(PAD.left, 4, 10, 3);
  ctx.fillText(LANG==='ko'?'ìµœê³ ':'High', PAD.left+14, 10);

  ctx.fillStyle = '#818cf8';
  ctx.fillRect(PAD.left+60, 4, 10, 3);
  ctx.fillText(LANG==='ko'?'ìµœì €':'Low', PAD.left+74, 10);
}
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ì´ˆê¸° ë¡œë“œ
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
window.addEventListener('load',()=>{
  if(navigator.userAgent.includes('Electron')){
    document.body.classList.add('electron-app');
  }
  inp.placeholder = t('searchPlaceholder');
  renderFavBar();
  const seoul=CITIES[0];
  inp.value=seoul.n;
  loadWeather(seoul.la,seoul.lo,seoul.n,seoul.e,seoul.f);
});



</script>
</body>
</html>
